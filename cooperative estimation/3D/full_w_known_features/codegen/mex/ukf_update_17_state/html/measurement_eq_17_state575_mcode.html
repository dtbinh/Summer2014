<pre class="code">
<span class="srcline"><span class="lineno"><a href="122,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T69U3">yk</span> = measurement_eq_17_state(<span class="var type1" id="S3T67U6">xk</span>,<span class="var type1" id="S4T73U7">nk</span>,<span class="var type1" id="S5T4U8">uk</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="122,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% m1: # of features agent 1 sees</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% m2: # of features agent 2 sees</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%xk: 17 x 2N+1, inertial position, inertial velocity, inertial quaternion, relative position, and relative quaternion</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%nk: 12+3*m1+3*m2 x 2N+1, error on range/bearing/azimuth for agent 1, then agent 2, then magnetometer errors for agent 1 then 2, </span></span></span>
<span class="srcline"><span class="lineno"><a href="122,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%       THEN feature range/bearing/azimuth errors FOR EACH FEATURE for agent 1, then same for agent 2 </span></span></span>
<span class="srcline"><span class="lineno"><a href="122,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,10" id="srcline10">10</a></span><span class="line"><span class="comment">%uk[wi;ai;mag_i;# of i features;rkn;<span class="keyword">...</span><span class="comment">;# of j features;rkn;...] : 9+2+3*m x 2N+1, m being total # of features from i and j </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="122,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo" id="T33:U5"><span class="var type1" id="S6T33U11">mag_i</span> = <span class="mxinfo" id="T33:U7"><span class="var type1" id="S5T4U13">uk</span>(<span class="mxinfo" id="T50:U9"><span class="mxinfo" id="T3:U10">7</span>:<span class="mxinfo" id="T3:U11">9</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo" id="T3:U12"><span class="var type1" id="S7T3U19">m1</span> = <span class="mxinfo" id="T3:U14"><span class="var type1" id="S5T4U21">uk</span>(<span class="mxinfo" id="T3:U16">10</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo" id="T3:U17"><span class="var type1" id="S8T3U25">m2</span> = <span class="mxinfo" id="T3:U19"><span class="var type1" id="S5T4U27">uk</span>(<span class="mxinfo" id="T3:U21"><span class="mxinfo" id="T3:U22"><span class="mxinfo" id="T3:U23">10</span>+<span class="mxinfo" id="T3:U24"><span class="mxinfo" id="T3:U25">3</span>*<span class="var type1" id="S7T3U33">m1</span></span></span>+<span class="mxinfo" id="T3:U27">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo" id="T3:U28"><span class="var type1" id="S9T3U37">m</span> = <span class="mxinfo" id="T3:U30"><span class="var type1" id="S7T3U39">m1</span>+<span class="var type1" id="S8T3U40">m2</span></span></span>;<span class="comment">% total # of features</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,18" id="srcline18">18</a></span><span class="line"><span class="comment">% 3 x m1 array of known inertial position of features seen by agent 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,19" id="srcline19">19</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T9:U33"><span class="var type1" id="S7T3U44">m1</span> &gt; <span class="mxinfo" id="T3:U35">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="122,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo" id="T72:U36"><span class="var type1" id="S10T72U48">RKN_1</span> = <span class="mxinfo" id="T95:U38"><span class="mxinfo" id="T74:U39">reshape(<span class="mxinfo" id="T2:U40"><span class="var type1" id="S5T4U53">uk</span>(<span class="mxinfo" id="T18:U42"><span class="mxinfo" id="T3:U43">10</span>+(<span class="mxinfo" id="T18:U44">1:<span class="mxinfo" id="T3:U45"><span class="var type1" id="S7T3U60">m1</span>*<span class="mxinfo" id="T3:U47">3</span></span></span>)</span>)</span>,3,[])</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,21" id="srcline21">21</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo" id="T72:U48"><span class="var type1" id="S10T72U68">RKN_1</span> = <span class="mxinfo" id="T30:U50">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,23" id="srcline23">23</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,24" id="srcline24">24</a></span><span class="line"><span class="comment">% 3 x m2 array of known inertial position of features seen by agent 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,25" id="srcline25">25</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T9:U51"><span class="var type1" id="S8T3U74">m2</span> &gt; <span class="mxinfo" id="T3:U53">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="122,26" id="srcline26">26</a></span><span class="line">    <span class="mxinfo" id="T72:U54"><span class="var type1" id="S12T72U78">RKN_2</span> = <span class="mxinfo" id="T95:U56"><span class="mxinfo" id="T74:U57">reshape(<span class="mxinfo" id="T2:U58"><span class="var type1" id="S5T4U83">uk</span>(<span class="mxinfo" id="T18:U60"><span class="mxinfo" id="T3:U61"><span class="mxinfo" id="T3:U62">10</span>+<span class="mxinfo" id="T3:U63"><span class="mxinfo" id="T3:U64">3</span>*<span class="var type1" id="S7T3U89">m1</span></span></span>+(<span class="mxinfo" id="T18:U66">1:<span class="mxinfo" id="T3:U67"><span class="mxinfo" id="T3:U68">3</span>*<span class="var type1" id="S8T3U95">m2</span></span></span>)</span>)</span>,3,[])</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,27" id="srcline27">27</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo" id="T72:U70"><span class="var type1" id="S12T72U102">RKN_2</span> = <span class="mxinfo" id="T30:U72">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,29" id="srcline29">29</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo" id="T3:U73"><span class="var type1" id="S13T3U107">n</span> = <span class="mxinfo" id="T3:U75">size(<span class="var type1" id="S3T67U110">xk</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo" id="T3:U77"><span class="var type1" id="S15T3U114">l</span> = <span class="mxinfo" id="T3:U79">size(<span class="var type1" id="S4T73U117">nk</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo" id="T69:U81"><span class="var type1" id="S2T69U121">yk</span> = <span class="mxinfo" id="T69:U83">zeros(<span class="mxinfo" id="T3:U84"><span class="mxinfo" id="T3:U85">9</span>+<span class="mxinfo" id="T3:U86"><span class="mxinfo" id="T3:U87">3</span>*<span class="var type1" id="S9T3U128">m</span></span></span>,<span class="mxinfo" id="T3:U89">size(<span class="var type1" id="S3T67U131">xk</span>,2)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,35" id="srcline35">35</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S17T3U135">k</span> = <span class="mxinfo" id="T3:U92">1</span>:<span class="mxinfo" id="T3:U93">size(<span class="var type1" id="S3T67U140">xk</span>,2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,36" id="srcline36">36</a></span><span class="line">    <span class="comment">% i to j frame transform</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo" id="T43:U95"><span class="var type1" id="S18T43U144">qhat</span> = <span class="mxinfo" id="T43:U97"><span class="var type1" id="S3T67U146">xk</span>(<span class="mxinfo" id="T83:U99"><span class="mxinfo" id="T3:U100">14</span>:<span class="mxinfo" id="T3:U101">17</span></span>,<span class="var type1" id="S17T3U150">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,38" id="srcline38">38</a></span><span class="line">    <span class="comment">% est relative position</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo" id="T33:U103"><span class="var type1" id="S19T33U153">rji_i_hat</span> = <span class="mxinfo" id="T33:U105"><span class="var type1" id="S3T67U155">xk</span>(<span class="mxinfo" id="T50:U107"><span class="mxinfo" id="T3:U108">11</span>:<span class="mxinfo" id="T3:U109">13</span></span>,<span class="var type1" id="S17T3U159">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,40" id="srcline40">40</a></span><span class="line">    <span class="comment">% estimated my inertial position</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo" id="T33:U111"><span class="var type1" id="S20T33U162">rin</span> = <span class="mxinfo" id="T33:U113"><span class="var type1" id="S3T67U164">xk</span>(<span class="mxinfo" id="T50:U115"><span class="mxinfo" id="T3:U116">1</span>:<span class="mxinfo" id="T3:U117">3</span></span>,<span class="var type1" id="S17T3U168">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,42" id="srcline42">42</a></span><span class="line">    <span class="comment">% my estimated inertial attitude</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo" id="T43:U119"><span class="var type1" id="S21T43U171">qin</span> = <span class="mxinfo" id="T43:U121"><span class="var type1" id="S3T67U173">xk</span>(<span class="mxinfo" id="T83:U123"><span class="mxinfo" id="T3:U124">7</span>:<span class="mxinfo" id="T3:U125">10</span></span>,<span class="var type1" id="S17T3U177">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,44" id="srcline44">44</a></span><span class="line">    <span class="mxinfo" id="T44:U127"><span class="var type1" id="S22T44U180">Cin</span> = <span class="mxinfo" id="T44:U129"><span class="fcn" id="F352N2:B182">attparsilentmex</span>(<span class="var type1" id="S21T43U183">qin</span>,[6 1])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,45" id="srcline45">45</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="122,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo" id="T44:U131"><span class="var type1" id="S24T44U190">Cji</span> = <span class="mxinfo" id="T44:U133"><span class="fcn" id="F352N2:B192">attparsilentmex</span>(<span class="var type1" id="S18T43U193">qhat</span>,[6 1])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,47" id="srcline47">47</a></span><span class="line">    <span class="comment">% expected range/bearing/azimuth from agent i's measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo" id="T33:U135"><span class="mxinfo" id="T33:U136"><span class="var type1" id="S2T69U201">yk</span>(<span class="mxinfo" id="T50:U138"><span class="mxinfo" id="T3:U139">1</span>:<span class="mxinfo" id="T3:U140">3</span></span>,<span class="var type1" id="S17T3U205">k</span>)</span> = <span class="mxinfo" id="T33:U142"><span class="mxinfo" id="T33:U143">[<span class="mxinfo" id="T3:U144">sqrt(<span class="mxinfo" id="T3:U145">sum(<span class="mxinfo" id="T33:U146"><span class="var type1" id="S19T33U214">rji_i_hat</span>.^2</span>)</span>)</span>;<span class="mxinfo" id="T3:U148">atan2(<span class="mxinfo" id="T3:U149"><span class="var type1" id="S19T33U220">rji_i_hat</span>(<span class="mxinfo" id="T3:U151">2</span>)</span>,<span class="mxinfo" id="T3:U152"><span class="var type1" id="S19T33U223">rji_i_hat</span>(<span class="mxinfo" id="T3:U154">1</span>)</span>)</span>;<span class="mxinfo" id="T3:U155">atan2(<span class="mxinfo" id="T3:U156"><span class="var type1" id="S19T33U229">rji_i_hat</span>(<span class="mxinfo" id="T3:U158">3</span>)</span>,<span class="mxinfo" id="T3:U159">sqrt(<span class="mxinfo" id="T3:U160">sum(<span class="mxinfo" id="T49:U161"><span class="mxinfo" id="T49:U162"><span class="var type1" id="S19T33U237">rji_i_hat</span>(<span class="mxinfo" id="T35:U164"><span class="mxinfo" id="T3:U165">1</span>:<span class="mxinfo" id="T3:U166">2</span></span>)</span>.^2</span>)</span>)</span>)</span>]</span> + <span class="mxinfo" id="T33:U167"><span class="var type1" id="S4T73U243">nk</span>(<span class="mxinfo" id="T50:U169"><span class="mxinfo" id="T3:U170">1</span>:<span class="mxinfo" id="T3:U171">3</span></span>,<span class="var type1" id="S17T3U247">k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,49" id="srcline49">49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,50" id="srcline50">50</a></span><span class="line">    <span class="comment">% expectated relative vector from agent j's measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,51" id="srcline51">51</a></span><span class="line">    <span class="mxinfo" id="T33:U173"><span class="var type1" id="S28T33U250">rij_j_hat</span> = <span class="mxinfo" id="T33:U175"><span class="mxinfo" id="T44:U176">-<span class="var type1" id="S24T44U253">Cji</span></span>*<span class="var type1" id="S19T33U254">rji_i_hat</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,52" id="srcline52">52</a></span><span class="line">    <span class="comment">% expected range/bearing/azimuth from agent j's measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,53" id="srcline53">53</a></span><span class="line">    <span class="mxinfo" id="T33:U179"><span class="mxinfo" id="T33:U180"><span class="var type1" id="S2T69U258">yk</span>(<span class="mxinfo" id="T50:U182"><span class="mxinfo" id="T3:U183">4</span>:<span class="mxinfo" id="T3:U184">6</span></span>,<span class="var type1" id="S17T3U262">k</span>)</span> = <span class="mxinfo" id="T33:U186"><span class="mxinfo" id="T33:U187">[<span class="mxinfo" id="T3:U188">sqrt(<span class="mxinfo" id="T3:U189">sum(<span class="mxinfo" id="T33:U190"><span class="var type1" id="S28T33U271">rij_j_hat</span>.^2</span>)</span>)</span>;<span class="mxinfo" id="T3:U192">atan2(<span class="mxinfo" id="T3:U193"><span class="var type1" id="S28T33U277">rij_j_hat</span>(<span class="mxinfo" id="T3:U195">2</span>)</span>,<span class="mxinfo" id="T3:U196"><span class="var type1" id="S28T33U280">rij_j_hat</span>(<span class="mxinfo" id="T3:U198">1</span>)</span>)</span>;<span class="mxinfo" id="T3:U199">atan2(<span class="mxinfo" id="T3:U200"><span class="var type1" id="S28T33U286">rij_j_hat</span>(<span class="mxinfo" id="T3:U202">3</span>)</span>,<span class="mxinfo" id="T3:U203">sqrt(<span class="mxinfo" id="T3:U204">sum(<span class="mxinfo" id="T49:U205"><span class="mxinfo" id="T49:U206"><span class="var type1" id="S28T33U294">rij_j_hat</span>(<span class="mxinfo" id="T35:U208"><span class="mxinfo" id="T3:U209">1</span>:<span class="mxinfo" id="T3:U210">2</span></span>)</span>.^2</span>)</span>)</span>)</span>]</span> + <span class="mxinfo" id="T33:U211"><span class="var type1" id="S4T73U300">nk</span>(<span class="mxinfo" id="T50:U213"><span class="mxinfo" id="T3:U214">4</span>:<span class="mxinfo" id="T3:U215">6</span></span>,<span class="var type1" id="S17T3U304">k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,54" id="srcline54">54</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="122,55" id="srcline55">55</a></span><span class="line">    <span class="comment">% expected magnetometer measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,56" id="srcline56">56</a></span><span class="line">    <span class="mxinfo" id="T33:U217"><span class="mxinfo" id="T33:U218"><span class="var type1" id="S2T69U308">yk</span>(<span class="mxinfo" id="T50:U220"><span class="mxinfo" id="T3:U221">7</span>:<span class="mxinfo" id="T3:U222">9</span></span>,<span class="var type1" id="S17T3U312">k</span>)</span> = <span class="mxinfo" id="T33:U224"><span class="mxinfo" id="T33:U225"><span class="var type1" id="S24T44U315">Cji</span>*(<span class="mxinfo" id="T33:U227"><span class="var type1" id="S6T33U318">mag_i</span> + <span class="mxinfo" id="T33:U229"><span class="var type1" id="S4T73U320">nk</span>(<span class="mxinfo" id="T50:U231"><span class="mxinfo" id="T3:U232">7</span>:<span class="mxinfo" id="T3:U233">9</span></span>,<span class="var type1" id="S17T3U324">k</span>)</span></span>)</span> - <span class="mxinfo" id="T33:U235"><span class="var type1" id="S4T73U326">nk</span>(<span class="mxinfo" id="T50:U237"><span class="mxinfo" id="T3:U238">10</span>:<span class="mxinfo" id="T3:U239">12</span></span>,<span class="var type1" id="S17T3U330">k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,57" id="srcline57">57</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="122,58" id="srcline58">58</a></span><span class="line">    <span class="comment">% feature measurements</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,59" id="srcline59">59</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S29T3U333">kk</span> = <span class="mxinfo" id="T3:U242">1</span>:<span class="var type1" id="S7T3U336">m1</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,60" id="srcline60">60</a></span><span class="line">        <span class="comment">% get the i frame vector to the feature</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,61" id="srcline61">61</a></span><span class="line">        <span class="mxinfo" id="T33:U244"><span class="var type1" id="S30T33U339">rki</span> = <span class="mxinfo" id="T33:U246"><span class="var type1" id="S22T44U341">Cin</span>*(<span class="mxinfo" id="T33:U248"><span class="mxinfo" id="T96:U249"><span class="mxinfo" id="T97:U250"><span class="var type1" id="S10T72U346">RKN_1</span>(<span class="var type1" id="S29T3U347">kk</span>,:)</span>'</span> - <span class="var type1" id="S20T33U349">rin</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,62" id="srcline62">62</a></span><span class="line">        <span class="comment">% the index for now</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,63" id="srcline63">63</a></span><span class="line">        <span class="mxinfo" id="T50:U254"><span class="var type1" id="S31T50U352">index</span> = <span class="mxinfo" id="T50:U256"><span class="mxinfo" id="T3:U257">(<span class="mxinfo" id="T3:U258"><span class="var type1" id="S29T3U357">kk</span>-<span class="mxinfo" id="T3:U260">1</span></span>)*<span class="mxinfo" id="T3:U261">3</span></span> + (<span class="mxinfo" id="T50:U262">1:3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,64" id="srcline64">64</a></span><span class="line">        <span class="comment">% compute range/bearing/declination</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,65" id="srcline65">65</a></span><span class="line">        <span class="mxinfo" id="T33:U263"><span class="var type1" id="S32T33U366">y_kk</span> = <span class="mxinfo" id="T33:U265"><span class="mxinfo" id="T33:U266">[<span class="mxinfo" id="T3:U267">sqrt(<span class="mxinfo" id="T3:U268">sum(<span class="mxinfo" id="T33:U269"><span class="var type1" id="S30T33U375">rki</span>.^2</span>)</span>)</span>;<span class="mxinfo" id="T3:U271">atan2(<span class="mxinfo" id="T3:U272"><span class="var type1" id="S30T33U381">rki</span>(<span class="mxinfo" id="T3:U274">2</span>)</span>,<span class="mxinfo" id="T3:U275"><span class="var type1" id="S30T33U384">rki</span>(<span class="mxinfo" id="T3:U277">1</span>)</span>)</span>;<span class="mxinfo" id="T3:U278">atan2(<span class="mxinfo" id="T3:U279"><span class="var type1" id="S30T33U390">rki</span>(<span class="mxinfo" id="T3:U281">3</span>)</span>,<span class="mxinfo" id="T3:U282">sqrt(<span class="mxinfo" id="T3:U283">sum(<span class="mxinfo" id="T49:U284"><span class="mxinfo" id="T49:U285"><span class="var type1" id="S30T33U398">rki</span>(<span class="mxinfo" id="T35:U287"><span class="mxinfo" id="T3:U288">1</span>:<span class="mxinfo" id="T3:U289">2</span></span>)</span>.^2</span>)</span>)</span>)</span>]</span> + <span class="mxinfo" id="T33:U290"><span class="var type1" id="S4T73U404">nk</span>(<span class="mxinfo" id="T50:U292"><span class="mxinfo" id="T3:U293">12</span> + <span class="var type1" id="S31T50U407">index</span></span>,<span class="var type1" id="S17T3U408">k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,66" id="srcline66">66</a></span><span class="line">        <span class="mxinfo" id="T33:U296"><span class="mxinfo" id="T33:U297"><span class="var type1" id="S2T69U412">yk</span>(<span class="mxinfo" id="T50:U299"><span class="mxinfo" id="T3:U300">9</span> + <span class="var type1" id="S31T50U415">index</span></span>,<span class="var type1" id="S17T3U416">k</span>)</span> = <span class="var type1" id="S32T33U417">y_kk</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,67" id="srcline67">67</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,68" id="srcline68">68</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="122,69" id="srcline69">69</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S29T3U420">kk</span> = <span class="mxinfo" id="T3:U305">1</span>:<span class="var type1" id="S8T3U423">m2</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,70" id="srcline70">70</a></span><span class="line">        <span class="comment">% get the j frame vector to the feature</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,71" id="srcline71">71</a></span><span class="line">        <span class="mxinfo" id="T33:U307"><span class="var type1" id="S33T33U426">rkj</span> = <span class="mxinfo" id="T33:U309"><span class="mxinfo" id="T44:U310"><span class="var type1" id="S24T44U429">Cji</span>*<span class="var type1" id="S22T44U430">Cin</span></span>*(<span class="mxinfo" id="T33:U313"><span class="mxinfo" id="T33:U314"><span class="mxinfo" id="T96:U315"><span class="mxinfo" id="T97:U316"><span class="var type1" id="S12T72U436">RKN_2</span>(<span class="var type1" id="S29T3U437">kk</span>,:)</span>'</span> - <span class="mxinfo" id="T33:U319"><span class="mxinfo" id="T44:U320"><span class="var type1" id="S22T44U441">Cin</span>'</span>*<span class="var type1" id="S19T33U442">rji_i_hat</span></span></span> - <span class="var type1" id="S20T33U443">rin</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,72" id="srcline72">72</a></span><span class="line">        <span class="comment">% the index for now</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,73" id="srcline73">73</a></span><span class="line">        <span class="mxinfo" id="T50:U324"><span class="var type1" id="S31T50U446">index</span> = <span class="mxinfo" id="T50:U326"><span class="mxinfo" id="T50:U327"><span class="mxinfo" id="T3:U328">(<span class="mxinfo" id="T3:U329"><span class="var type1" id="S29T3U452">kk</span>-<span class="mxinfo" id="T3:U331">1</span></span>)*<span class="mxinfo" id="T3:U332">3</span></span> + (<span class="mxinfo" id="T50:U333">1:3</span>)</span> + <span class="mxinfo" id="T3:U334"><span class="var type1" id="S7T3U460">m1</span>*<span class="mxinfo" id="T3:U336">3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,74" id="srcline74">74</a></span><span class="line">        <span class="comment">% compute range/bearing/declination</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,75" id="srcline75">75</a></span><span class="line">        <span class="mxinfo" id="T33:U337"><span class="var type1" id="S32T33U464">y_kk</span> = <span class="mxinfo" id="T33:U339"><span class="mxinfo" id="T33:U340">[<span class="mxinfo" id="T3:U341">sqrt(<span class="mxinfo" id="T3:U342">sum(<span class="mxinfo" id="T33:U343"><span class="var type1" id="S33T33U473">rkj</span>.^2</span>)</span>)</span>;<span class="mxinfo" id="T3:U345">atan2(<span class="mxinfo" id="T3:U346"><span class="var type1" id="S33T33U479">rkj</span>(<span class="mxinfo" id="T3:U348">2</span>)</span>,<span class="mxinfo" id="T3:U349"><span class="var type1" id="S33T33U482">rkj</span>(<span class="mxinfo" id="T3:U351">1</span>)</span>)</span>;<span class="mxinfo" id="T3:U352">atan2(<span class="mxinfo" id="T3:U353"><span class="var type1" id="S33T33U488">rkj</span>(<span class="mxinfo" id="T3:U355">3</span>)</span>,<span class="mxinfo" id="T3:U356">sqrt(<span class="mxinfo" id="T3:U357">sum(<span class="mxinfo" id="T49:U358"><span class="mxinfo" id="T49:U359"><span class="var type1" id="S33T33U496">rkj</span>(<span class="mxinfo" id="T35:U361"><span class="mxinfo" id="T3:U362">1</span>:<span class="mxinfo" id="T3:U363">2</span></span>)</span>.^2</span>)</span>)</span>)</span>]</span> + <span class="mxinfo" id="T33:U364"><span class="var type1" id="S4T73U502">nk</span>(<span class="mxinfo" id="T50:U366"><span class="mxinfo" id="T3:U367">12</span> + <span class="var type1" id="S31T50U505">index</span></span>,<span class="var type1" id="S17T3U506">k</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,76" id="srcline76">76</a></span><span class="line">        <span class="mxinfo" id="T33:U370"><span class="mxinfo" id="T33:U371"><span class="var type1" id="S2T69U510">yk</span>(<span class="mxinfo" id="T50:U373"><span class="mxinfo" id="T3:U374">9</span> + <span class="var type1" id="S31T50U513">index</span></span>,<span class="var type1" id="S17T3U514">k</span>)</span> = <span class="var type1" id="S32T33U515">y_kk</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,77" id="srcline77">77</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,78" id="srcline78">78</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="122,79" id="srcline79">79</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T9:U378"><span class="var type1" id="S17T3U519">k</span> &gt; <span class="mxinfo" id="T3:U380">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="122,80" id="srcline80">80</a></span><span class="line">        <span class="comment">% minimize all angle differences</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,81" id="srcline81">81</a></span><span class="line">        <span class="mxinfo" id="T43:U381"><span class="mxinfo" id="T43:U382"><span class="var type1" id="S2T69U524">yk</span>(<span class="mxinfo" id="T43:U384">[<span class="mxinfo" id="T3:U385">2</span>;<span class="mxinfo" id="T3:U386">3</span>;<span class="mxinfo" id="T3:U387">5</span>;<span class="mxinfo" id="T3:U388">6</span>]</span>,<span class="var type1" id="S17T3U534">k</span>)</span> = <span class="mxinfo" id="T43:U390"><span class="fcn" id="F540N9:B536">minangle</span>(<span class="mxinfo" id="T43:U391"><span class="var type1" id="S2T69U538">yk</span>(<span class="mxinfo" id="T43:U393">[<span class="mxinfo" id="T3:U394">2</span>;<span class="mxinfo" id="T3:U395">3</span>;<span class="mxinfo" id="T3:U396">5</span>;<span class="mxinfo" id="T3:U397">6</span>]</span>,<span class="var type1" id="S17T3U548">k</span>)</span>,<span class="mxinfo" id="T43:U399"><span class="var type1" id="S2T69U550">yk</span>(<span class="mxinfo" id="T43:U401">[<span class="mxinfo" id="T3:U402">2</span>;<span class="mxinfo" id="T3:U403">3</span>;<span class="mxinfo" id="T3:U404">5</span>;<span class="mxinfo" id="T3:U405">6</span>]</span>,<span class="mxinfo" id="T3:U406">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,82" id="srcline82">82</a></span><span class="line">        <span class="mxinfo" id="T2:U407"><span class="mxinfo" id="T2:U408"><span class="var type1" id="S2T69U564">yk</span>( <span class="mxinfo" id="T18:U410"><span class="mxinfo" id="T3:U411">9</span> + (<span class="mxinfo" id="T18:U412">2:3:<span class="mxinfo" id="T3:U413"><span class="mxinfo" id="T3:U414">3</span>*<span class="var type1" id="S7T3U574">m1</span></span></span>)</span>,<span class="var type1" id="S17T3U575">k</span> )</span> = <span class="mxinfo" id="T2:U417"><span class="fcn" id="F568N9:B577">minangle</span>(<span class="mxinfo" id="T2:U418"><span class="var type1" id="S2T69U579">yk</span>(<span class="mxinfo" id="T18:U420"><span class="mxinfo" id="T3:U421">9</span> + (<span class="mxinfo" id="T18:U422">2:3:<span class="mxinfo" id="T3:U423"><span class="mxinfo" id="T3:U424">3</span>*<span class="var type1" id="S7T3U589">m1</span></span></span>)</span>,<span class="var type1" id="S17T3U590">k</span>)</span>,<span class="mxinfo" id="T2:U427"><span class="var type1" id="S2T69U592">yk</span>(<span class="mxinfo" id="T18:U429"><span class="mxinfo" id="T3:U430">9</span> + (<span class="mxinfo" id="T18:U431">2:3:<span class="mxinfo" id="T3:U432"><span class="mxinfo" id="T3:U433">3</span>*<span class="var type1" id="S7T3U602">m1</span></span></span>)</span>,<span class="mxinfo" id="T3:U435">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,83" id="srcline83">83</a></span><span class="line">        <span class="mxinfo" id="T2:U436"><span class="mxinfo" id="T2:U437"><span class="var type1" id="S2T69U607">yk</span>( <span class="mxinfo" id="T18:U439"><span class="mxinfo" id="T3:U440">9</span> + (<span class="mxinfo" id="T18:U441">3:3:<span class="mxinfo" id="T3:U442"><span class="mxinfo" id="T3:U443">3</span>*<span class="var type1" id="S7T3U617">m1</span></span></span>)</span>,<span class="var type1" id="S17T3U618">k</span> )</span> = <span class="mxinfo" id="T2:U446"><span class="fcn" id="F568N9:B620">minangle</span>(<span class="mxinfo" id="T2:U447"><span class="var type1" id="S2T69U622">yk</span>(<span class="mxinfo" id="T18:U449"><span class="mxinfo" id="T3:U450">9</span> + (<span class="mxinfo" id="T18:U451">3:3:<span class="mxinfo" id="T3:U452"><span class="mxinfo" id="T3:U453">3</span>*<span class="var type1" id="S7T3U632">m1</span></span></span>)</span>,<span class="var type1" id="S17T3U633">k</span>)</span>,<span class="mxinfo" id="T2:U456"><span class="var type1" id="S2T69U635">yk</span>(<span class="mxinfo" id="T18:U458"><span class="mxinfo" id="T3:U459">9</span> + (<span class="mxinfo" id="T18:U460">3:3:<span class="mxinfo" id="T3:U461"><span class="mxinfo" id="T3:U462">3</span>*<span class="var type1" id="S7T3U645">m1</span></span></span>)</span>,<span class="mxinfo" id="T3:U464">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,84" id="srcline84">84</a></span><span class="line">        <span class="mxinfo" id="T2:U465"><span class="mxinfo" id="T2:U466"><span class="var type1" id="S2T69U650">yk</span>( <span class="mxinfo" id="T18:U468"><span class="mxinfo" id="T3:U469"><span class="mxinfo" id="T3:U470">9</span> + <span class="mxinfo" id="T3:U471"><span class="mxinfo" id="T3:U472">3</span>*<span class="var type1" id="S7T3U656">m1</span></span></span> + (<span class="mxinfo" id="T18:U474">2:3:<span class="mxinfo" id="T3:U475"><span class="mxinfo" id="T3:U476">3</span>*<span class="var type1" id="S8T3U664">m2</span></span></span>)</span>,<span class="var type1" id="S17T3U665">k</span> )</span> = <span class="mxinfo" id="T2:U479"><span class="fcn" id="F568N9:B667">minangle</span>( <span class="mxinfo" id="T2:U480"><span class="var type1" id="S2T69U669">yk</span>( <span class="mxinfo" id="T18:U482"><span class="mxinfo" id="T3:U483"><span class="mxinfo" id="T3:U484">9</span> + <span class="mxinfo" id="T3:U485"><span class="mxinfo" id="T3:U486">3</span>*<span class="var type1" id="S7T3U675">m1</span></span></span> + (<span class="mxinfo" id="T18:U488">2:3:<span class="mxinfo" id="T3:U489"><span class="mxinfo" id="T3:U490">3</span>*<span class="var type1" id="S8T3U683">m2</span></span></span>)</span>,<span class="var type1" id="S17T3U684">k</span> )</span>, <span class="mxinfo" id="T2:U493"><span class="var type1" id="S2T69U686">yk</span>( <span class="mxinfo" id="T18:U495"><span class="mxinfo" id="T3:U496"><span class="mxinfo" id="T3:U497">9</span> + <span class="mxinfo" id="T3:U498"><span class="mxinfo" id="T3:U499">3</span>*<span class="var type1" id="S7T3U692">m1</span></span></span> + (<span class="mxinfo" id="T18:U501">2:3:<span class="mxinfo" id="T3:U502"><span class="mxinfo" id="T3:U503">3</span>*<span class="var type1" id="S8T3U700">m2</span></span></span>)</span>,<span class="mxinfo" id="T3:U505">1</span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,85" id="srcline85">85</a></span><span class="line">        <span class="mxinfo" id="T2:U506"><span class="mxinfo" id="T2:U507"><span class="var type1" id="S2T69U705">yk</span>( <span class="mxinfo" id="T18:U509"><span class="mxinfo" id="T3:U510"><span class="mxinfo" id="T3:U511">9</span> + <span class="mxinfo" id="T3:U512"><span class="mxinfo" id="T3:U513">3</span>*<span class="var type1" id="S7T3U711">m1</span></span></span> + (<span class="mxinfo" id="T18:U515">3:3:<span class="mxinfo" id="T3:U516"><span class="mxinfo" id="T3:U517">3</span>*<span class="var type1" id="S8T3U719">m2</span></span></span>)</span>,<span class="var type1" id="S17T3U720">k</span> )</span> = <span class="mxinfo" id="T2:U520"><span class="fcn" id="F568N9:B722">minangle</span>( <span class="mxinfo" id="T2:U521"><span class="var type1" id="S2T69U724">yk</span>( <span class="mxinfo" id="T18:U523"><span class="mxinfo" id="T3:U524"><span class="mxinfo" id="T3:U525">9</span> + <span class="mxinfo" id="T3:U526"><span class="mxinfo" id="T3:U527">3</span>*<span class="var type1" id="S7T3U730">m1</span></span></span> + (<span class="mxinfo" id="T18:U529">3:3:<span class="mxinfo" id="T3:U530"><span class="mxinfo" id="T3:U531">3</span>*<span class="var type1" id="S8T3U738">m2</span></span></span>)</span>,<span class="var type1" id="S17T3U739">k</span> )</span>, <span class="mxinfo" id="T2:U534"><span class="var type1" id="S2T69U741">yk</span>( <span class="mxinfo" id="T18:U536"><span class="mxinfo" id="T3:U537"><span class="mxinfo" id="T3:U538">9</span> + <span class="mxinfo" id="T3:U539"><span class="mxinfo" id="T3:U540">3</span>*<span class="var type1" id="S7T3U747">m1</span></span></span> + (<span class="mxinfo" id="T18:U542">3:3:<span class="mxinfo" id="T3:U543"><span class="mxinfo" id="T3:U544">3</span>*<span class="var type1" id="S8T3U755">m2</span></span></span>)</span>,<span class="mxinfo" id="T3:U546">1</span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="122,86" id="srcline86">86</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,87" id="srcline87">87</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="122,88" id="srcline88">88</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="122,89" id="srcline89">89</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
