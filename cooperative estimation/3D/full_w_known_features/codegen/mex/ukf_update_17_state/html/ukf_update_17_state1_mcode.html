<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">xnew</span>,<span class="var type1" id="S3T6U4">Pnew</span>] = ukf_update_17_state(<span class="var type1" id="S4T1U7">xk</span>,<span class="var type1" id="S5T6U8">Pxk</span>,<span class="var type1" id="S6T6U9">Pvk</span>,<span class="var type1" id="S7T5U10">Pnk</span>,<span class="var type1" id="S8T4U11">uk</span>,<span class="var type1" id="S9T4U12">ytilde</span>,<span class="var type1" id="S10T3U13">alpha</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">% Pxk: covariance associated with state</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% Pvk: covariance associated with process noise</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% Pnk: covariance assocaited with measurement noise</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% vector lengths</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="mxinfo" id="T3:U10"><span class="var type1" id="S11T3U16">n</span> = <span class="mxinfo" id="T3:U12">length(<span class="var type1" id="S4T1U19">xk</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="mxinfo" id="T3:U14"><span class="var type1" id="S13T3U22">m</span> = <span class="mxinfo" id="T3:U16">length(<span class="var type1" id="S8T4U25">uk</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="mxinfo" id="T3:U18"><span class="var type1" id="S14T3U28">nl</span> = <span class="mxinfo" id="T3:U20">size(<span class="var type1" id="S7T5U31">Pnk</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="mxinfo" id="T3:U22"><span class="var type1" id="S16T3U35">vl</span> = <span class="mxinfo" id="T3:U24">size(<span class="var type1" id="S6T6U38">Pvk</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="mxinfo" id="T3:U26"><span class="var type1" id="S17T3U42">N</span> = <span class="mxinfo" id="T3:U28"><span class="mxinfo" id="T3:U29"><span class="var type1" id="S11T3U45">n</span>+<span class="var type1" id="S14T3U46">nl</span></span>+<span class="var type1" id="S16T3U47">vl</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">% number of known features seen by agents i and j (1 and 2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="mxinfo" id="T3:U33"><span class="var type1" id="S18T3U50">m1</span> = <span class="mxinfo" id="T3:U35"><span class="var type1" id="S8T4U52">uk</span>(<span class="mxinfo" id="T3:U37">10</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="mxinfo" id="T3:U38"><span class="var type1" id="S19T3U56">m2</span> = <span class="mxinfo" id="T3:U40"><span class="var type1" id="S8T4U58">uk</span>(<span class="mxinfo" id="T3:U42"><span class="mxinfo" id="T3:U43"><span class="mxinfo" id="T3:U44">10</span> + <span class="mxinfo" id="T3:U45">1</span></span> + <span class="mxinfo" id="T3:U46"><span class="mxinfo" id="T3:U47">3</span>*<span class="var type1" id="S18T3U65">m1</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">% constant gamma that influences sigma points</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="keyword">if</span> nargin &lt; 7</span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line">    <span class="var type2" id="S10T0U74">alpha</span> = 1e-3;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="mxinfo" id="T3:U49"><span class="var type1" id="S21T3U78">Kappa</span> = <span class="mxinfo" id="T3:U51">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="mxinfo" id="T3:U52"><span class="var type1" id="S22T3U82">lambda</span> = <span class="mxinfo" id="T3:U54"><span class="mxinfo" id="T3:U55"><span class="mxinfo" id="T3:U56"><span class="var type1" id="S10T3U86">alpha</span>^2</span>*(<span class="mxinfo" id="T3:U58"><span class="var type1" id="S17T3U90">N</span>+<span class="mxinfo" id="T3:U60"><span class="var type1" id="S21T3U91">Kappa</span></span></span>)</span>-<span class="var type1" id="S17T3U92">N</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="mxinfo" id="T3:U63"><span class="var type1" id="S23T3U95">gamm</span> = <span class="mxinfo" id="T3:U65">sqrt(<span class="mxinfo" id="T3:U66"><span class="var type1" id="S17T3U99">N</span>+<span class="var type1" id="S22T3U100">lambda</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%augmented covariance and state</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo" id="T63:U69"><span class="var type1" id="S25T63U103">Paug</span> = <span class="mxinfo" id="T63:U71">zeros(<span class="var type1" id="S17T3U106">N</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo" id="T6:U73"><span class="mxinfo" id="T6:U74"><span class="var type1" id="S25T63U110">Paug</span>(<span class="mxinfo" id="T9:U76"><span class="mxinfo" id="T3:U77">1</span>:<span class="var type1" id="S11T3U113">n</span></span>,<span class="mxinfo" id="T9:U79"><span class="mxinfo" id="T3:U80">1</span>:<span class="var type1" id="S11T3U116">n</span></span>)</span> = <span class="var type1" id="S5T6U117">Pxk</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo" id="T6:U83"><span class="mxinfo" id="T6:U84"><span class="var type1" id="S25T63U121">Paug</span>(<span class="mxinfo" id="T80:U86"><span class="var type1" id="S11T3U123">n</span>+(<span class="mxinfo" id="T18:U88">1:<span class="var type1" id="S16T3U127">vl</span></span>)</span>,<span class="mxinfo" id="T80:U90"><span class="var type1" id="S11T3U129">n</span>+(<span class="mxinfo" id="T18:U92">1:<span class="var type1" id="S16T3U133">vl</span></span>)</span>)</span> = <span class="var type1" id="S6T6U134">Pvk</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo" id="T5:U95"><span class="mxinfo" id="T5:U96"><span class="var type1" id="S25T63U138">Paug</span>(<span class="mxinfo" id="T81:U98"><span class="mxinfo" id="T3:U99"><span class="var type1" id="S11T3U141">n</span>+<span class="var type1" id="S16T3U142">vl</span></span>+(<span class="mxinfo" id="T18:U102">1:<span class="var type1" id="S14T3U146">nl</span></span>)</span>,<span class="mxinfo" id="T81:U104"><span class="mxinfo" id="T3:U105"><span class="var type1" id="S11T3U149">n</span>+<span class="var type1" id="S16T3U150">vl</span></span>+(<span class="mxinfo" id="T18:U108">1:<span class="var type1" id="S14T3U154">nl</span></span>)</span>)</span> = <span class="var type1" id="S7T5U155">Pnk</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo" id="T64:U111"><span class="var type1" id="S27T64U158">xaug</span> = <span class="mxinfo" id="T64:U113">[<span class="var type1" id="S4T1U161">xk</span>;<span class="mxinfo" id="T82:U115">zeros(<span class="mxinfo" id="T3:U116"><span class="var type1" id="S14T3U166">nl</span>+<span class="var type1" id="S16T3U167">vl</span></span>,1)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo" id="T37:U119">[<span class="var type1" id="S28T65U172">Psq</span>,<span class="var type1" id="S29T3U173">resnorm</span>] = sqrtm(<span class="var type1" id="S25T63U176">Paug</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="keyword">if</span> (<span class="mxinfo" id="T9:U123"><span class="mxinfo" id="T3:U124">abs(<span class="var type1" id="S29T3U183">resnorm</span>)</span> &gt; <span class="mxinfo" id="T3:U126">1e-14</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line">    fprintf(<span class="string">'Error: matrix square root residual norm is %g.\n'</span>,<span class="var type1" id="S29T3U189">resnorm</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line">    <span class="mxinfo" id="T1:U128"><span class="var type1" id="S2T1U192">xnew</span> = <span class="mxinfo" id="T3:U130">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line">    <span class="mxinfo" id="T6:U131"><span class="var type1" id="S3T6U196">Pnew</span> = <span class="mxinfo" id="T3:U133">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="mxinfo" id="T63:U134"><span class="var type1" id="S28T63U201">Psq</span> = <span class="mxinfo" id="T63:U136">real(<span class="var type1" id="S28T65U204">Psq</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">% compute the sigma points</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo" id="T66:U138"><span class="var type1" id="S34T66U207">XAUG</span> = <span class="mxinfo" id="T66:U140">zeros(<span class="var type1" id="S17T3U210">N</span>,<span class="mxinfo" id="T3:U142"><span class="mxinfo" id="T3:U143"><span class="mxinfo" id="T3:U144">2</span>*<span class="var type1" id="S17T3U214">N</span></span>+<span class="mxinfo" id="T3:U146">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="mxinfo" id="T64:U147"><span class="mxinfo" id="T64:U148"><span class="var type1" id="S34T66U219">XAUG</span>(:,<span class="mxinfo" id="T3:U150">1</span>)</span> = <span class="var type1" id="S27T64U222">xaug</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S35T3U225">k</span> = <span class="mxinfo" id="T3:U153">1</span>:<span class="var type1" id="S17T3U228">N</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line">    <span class="mxinfo" id="T64:U155"><span class="mxinfo" id="T64:U156"><span class="var type1" id="S34T66U232">XAUG</span>(:,<span class="mxinfo" id="T3:U158"><span class="var type1" id="S35T3U235">k</span>+<span class="mxinfo" id="T3:U160">1</span></span>)</span> = <span class="mxinfo" id="T64:U161"><span class="var type1" id="S27T64U238">xaug</span> + <span class="mxinfo" id="T2:U163"><span class="var type1" id="S23T3U240">gamm</span>*<span class="mxinfo" id="T64:U165"><span class="var type1" id="S28T63U242">Psq</span>(:,<span class="var type1" id="S35T3U244">k</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line">    <span class="mxinfo" id="T64:U168"><span class="mxinfo" id="T64:U169"><span class="var type1" id="S34T66U248">XAUG</span>(:,<span class="mxinfo" id="T3:U171"><span class="mxinfo" id="T3:U172"><span class="var type1" id="S17T3U252">N</span>+<span class="mxinfo" id="T3:U174">1</span></span>+<span class="var type1" id="S35T3U254">k</span></span>)</span> = <span class="mxinfo" id="T64:U176"><span class="var type1" id="S27T64U256">xaug</span> - <span class="mxinfo" id="T2:U178"><span class="var type1" id="S23T3U258">gamm</span>*<span class="mxinfo" id="T64:U180"><span class="var type1" id="S28T63U260">Psq</span>(:,<span class="var type1" id="S35T3U262">k</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">% propagate the sigma points</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo" id="T67:U183"><span class="var type1" id="S36T67U265">XAUGPLUS</span> = <span class="mxinfo" id="T67:U185"><span class="fcn" id="F408N13:B267">update_eq_17_state</span>(<span class="mxinfo" id="T67:U186"><span class="var type1" id="S34T66U269">XAUG</span>(<span class="mxinfo" id="T9:U188"><span class="mxinfo" id="T3:U189">1</span>:<span class="var type1" id="S11T3U272">n</span></span>,:)</span>,<span class="mxinfo" id="T67:U191"><span class="var type1" id="S34T66U275">XAUG</span>(<span class="mxinfo" id="T80:U193"><span class="var type1" id="S11T3U277">n</span>+(<span class="mxinfo" id="T18:U195">1:<span class="var type1" id="S16T3U281">vl</span></span>)</span>,:)</span>,<span class="var type1" id="S8T4U283">uk</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">% weights</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo" id="T3:U198"><span class="var type1" id="S38T3U286">beta</span> = <span class="mxinfo" id="T3:U200">2</span></span>;<span class="comment">% optimal for Gaussian</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo" id="T68:U201"><span class="var type1" id="S39T68U290">wc</span> = <span class="mxinfo" id="T2:U203"><span class="mxinfo" id="T3:U204"><span class="mxinfo" id="T3:U205">0.5</span>/(<span class="mxinfo" id="T3:U206"><span class="var type1" id="S17T3U296">N</span>+<span class="var type1" id="S22T3U297">lambda</span></span>)</span>*<span class="mxinfo" id="T68:U209">ones(<span class="mxinfo" id="T3:U210"><span class="mxinfo" id="T3:U211"><span class="mxinfo" id="T3:U212">2</span>*<span class="var type1" id="S17T3U303">N</span></span>+<span class="mxinfo" id="T3:U214">1</span></span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo" id="T68:U215"><span class="var type1" id="S41T68U308">wm</span> = <span class="mxinfo" id="T2:U217"><span class="mxinfo" id="T3:U218"><span class="mxinfo" id="T3:U219">0.5</span>/(<span class="mxinfo" id="T3:U220"><span class="var type1" id="S17T3U314">N</span>+<span class="var type1" id="S22T3U315">lambda</span></span>)</span>*<span class="mxinfo" id="T68:U223">ones(<span class="mxinfo" id="T3:U224"><span class="mxinfo" id="T3:U225"><span class="mxinfo" id="T3:U226">2</span>*<span class="var type1" id="S17T3U321">N</span></span>+<span class="mxinfo" id="T3:U228">1</span></span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo" id="T3:U229"><span class="mxinfo" id="T3:U230"><span class="var type1" id="S41T68U327">wm</span>(<span class="mxinfo" id="T3:U232">1</span>)</span> = <span class="mxinfo" id="T3:U233"><span class="var type1" id="S22T3U330">lambda</span>/(<span class="mxinfo" id="T3:U235"><span class="var type1" id="S17T3U333">N</span>+<span class="var type1" id="S22T3U334">lambda</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo" id="T3:U238"><span class="mxinfo" id="T3:U239"><span class="var type1" id="S39T68U338">wc</span>(<span class="mxinfo" id="T3:U241">1</span>)</span> = <span class="mxinfo" id="T3:U242"><span class="mxinfo" id="T3:U243"><span class="mxinfo" id="T3:U244"><span class="mxinfo" id="T3:U245"><span class="var type1" id="S22T3U344">lambda</span>/(<span class="mxinfo" id="T3:U247"><span class="var type1" id="S17T3U347">N</span>+<span class="var type1" id="S22T3U348">lambda</span></span>)</span> + <span class="mxinfo" id="T3:U250">1</span></span>-<span class="mxinfo" id="T3:U251"><span class="var type1" id="S10T3U351">alpha</span>^2</span></span>+<span class="mxinfo" id="T3:U253"><span class="var type1" id="S38T3U353">beta</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">% calculate the update</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="mxinfo" id="T1:U255"><span class="var type1" id="S42T1U356">xp</span> = <span class="mxinfo" id="T2:U257">sum(<span class="mxinfo" id="T67:U258"><span class="mxinfo" id="T67:U259"><span class="var type1" id="S36T67U361">XAUGPLUS</span>(<span class="mxinfo" id="T9:U261"><span class="mxinfo" id="T3:U262">1</span>:<span class="var type1" id="S11T3U364">n</span></span>,:)</span>.*<span class="mxinfo" id="T69:U264">repmat(<span class="mxinfo" id="T75:U265"><span class="var type1" id="S41T68U369">wm</span>'</span>,<span class="var type1" id="S11T3U370">n</span>,1)</span></span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% re-normalize</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="mxinfo" id="T83:U268"><span class="mxinfo" id="T83:U269"><span class="var type1" id="S42T1U376">xp</span>(<span class="mxinfo" id="T83:U271"><span class="mxinfo" id="T3:U272">7</span>:<span class="mxinfo" id="T3:U273">10</span></span>)</span> = <span class="mxinfo" id="T43:U274"><span class="mxinfo" id="T43:U275"><span class="var type1" id="S42T1U382">xp</span>(<span class="mxinfo" id="T83:U277"><span class="mxinfo" id="T3:U278">7</span>:<span class="mxinfo" id="T3:U279">10</span></span>)</span>/<span class="mxinfo" id="T3:U280">norm(<span class="mxinfo" id="T43:U281"><span class="var type1" id="S42T1U389">xp</span>(<span class="mxinfo" id="T83:U283"><span class="mxinfo" id="T3:U284">7</span>:<span class="mxinfo" id="T3:U285">10</span></span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo" id="T83:U286"><span class="mxinfo" id="T83:U287"><span class="var type1" id="S42T1U396">xp</span>(<span class="mxinfo" id="T83:U289"><span class="mxinfo" id="T3:U290">14</span>:<span class="mxinfo" id="T3:U291">17</span></span>)</span> = <span class="mxinfo" id="T43:U292"><span class="mxinfo" id="T43:U293"><span class="var type1" id="S42T1U402">xp</span>(<span class="mxinfo" id="T83:U295"><span class="mxinfo" id="T3:U296">14</span>:<span class="mxinfo" id="T3:U297">17</span></span>)</span>/<span class="mxinfo" id="T3:U298">norm(<span class="mxinfo" id="T43:U299"><span class="var type1" id="S42T1U409">xp</span>(<span class="mxinfo" id="T83:U301"><span class="mxinfo" id="T3:U302">14</span>:<span class="mxinfo" id="T3:U303">17</span></span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="mxinfo" id="T6:U304"><span class="var type1" id="S46T6U415">Pp</span> = <span class="mxinfo" id="T6:U306">zeros(<span class="var type1" id="S11T3U418">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S35T3U421">k</span> = <span class="mxinfo" id="T3:U309">1</span>:<span class="mxinfo" id="T3:U310"><span class="mxinfo" id="T3:U311"><span class="mxinfo" id="T3:U312">2</span>*<span class="var type1" id="S17T3U427">N</span></span>+<span class="mxinfo" id="T3:U314">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">    <span class="mxinfo" id="T6:U315"><span class="var type1" id="S46T6U431">Pp</span> = <span class="mxinfo" id="T6:U317"><span class="var type1" id="S46T6U433">Pp</span> + <span class="mxinfo" id="T12:U319"><span class="mxinfo" id="T2:U320"><span class="mxinfo" id="T3:U321"><span class="var type1" id="S39T68U437">wc</span>(<span class="var type1" id="S35T3U438">k</span>)</span>*(<span class="mxinfo" id="T1:U324"><span class="mxinfo" id="T1:U325"><span class="var type1" id="S36T67U442">XAUGPLUS</span>(<span class="mxinfo" id="T9:U327"><span class="mxinfo" id="T3:U328">1</span>:<span class="var type1" id="S11T3U445">n</span></span>,<span class="var type1" id="S35T3U446">k</span>)</span>-<span class="var type1" id="S42T1U447">xp</span></span>)</span>*<span class="mxinfo" id="T80:U332">(<span class="mxinfo" id="T1:U333"><span class="mxinfo" id="T1:U334"><span class="var type1" id="S36T67U452">XAUGPLUS</span>(<span class="mxinfo" id="T9:U336"><span class="mxinfo" id="T3:U337">1</span>:<span class="var type1" id="S11T3U455">n</span></span>,<span class="var type1" id="S35T3U456">k</span>)</span>-<span class="var type1" id="S42T1U457">xp</span></span>)'</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">% pass the sigma points through the measurement function</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"><span class="mxinfo" id="T69:U341"><span class="var type1" id="S47T69U460">YKAUG</span> = <span class="mxinfo" id="T69:U343"><span class="fcn" id="F576N7:B462">measurement_eq_17_state</span>(<span class="mxinfo" id="T67:U344"><span class="var type1" id="S36T67U464">XAUGPLUS</span>(<span class="mxinfo" id="T9:U346"><span class="mxinfo" id="T3:U347">1</span>:<span class="var type1" id="S11T3U467">n</span></span>,:)</span>,<span class="mxinfo" id="T73:U349"><span class="var type1" id="S34T66U470">XAUG</span>(<span class="mxinfo" id="T81:U351"><span class="mxinfo" id="T3:U352"><span class="var type1" id="S11T3U473">n</span>+<span class="var type1" id="S16T3U474">vl</span></span>+(<span class="mxinfo" id="T18:U355">1:<span class="var type1" id="S14T3U478">nl</span></span>)</span>,:)</span>,<span class="var type1" id="S8T4U480">uk</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="mxinfo" id="T3:U358"><span class="var type1" id="S49T3U483">g</span> = <span class="mxinfo" id="T3:U360">size(<span class="var type1" id="S47T69U486">YKAUG</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="mxinfo" id="T2:U362"><span class="var type1" id="S50T2U490">yhat</span> = <span class="mxinfo" id="T2:U364">sum(<span class="mxinfo" id="T69:U365"><span class="var type1" id="S47T69U494">YKAUG</span>.*<span class="mxinfo" id="T69:U367">repmat(<span class="mxinfo" id="T75:U368"><span class="var type1" id="S41T68U498">wm</span>'</span>,<span class="var type1" id="S49T3U499">g</span>,1)</span></span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">% add something to handle magnetometer normalization if necessary here</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"><span class="comment">% measurement covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="mxinfo" id="T12:U371"><span class="var type1" id="S51T12U504">Pyk</span> = <span class="mxinfo" id="T12:U373">zeros(<span class="var type1" id="S49T3U507">g</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">% cross covariance</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"><span class="mxinfo" id="T70:U375"><span class="var type1" id="S52T70U510">Pxkyk</span> = <span class="mxinfo" id="T70:U377">zeros(<span class="var type1" id="S11T3U513">n</span>,<span class="var type1" id="S49T3U514">g</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S35T3U517">k</span> = <span class="mxinfo" id="T3:U381">1</span>:<span class="mxinfo" id="T3:U382"><span class="mxinfo" id="T3:U383"><span class="mxinfo" id="T3:U384">2</span>*<span class="var type1" id="S17T3U523">N</span></span>+<span class="mxinfo" id="T3:U386">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">    <span class="mxinfo" id="T12:U387"><span class="var type1" id="S51T12U527">Pyk</span> = <span class="mxinfo" id="T12:U389"><span class="var type1" id="S51T12U529">Pyk</span> + <span class="mxinfo" id="T12:U391"><span class="mxinfo" id="T2:U392"><span class="mxinfo" id="T3:U393"><span class="var type1" id="S39T68U533">wc</span>(<span class="var type1" id="S35T3U534">k</span>)</span>*(<span class="mxinfo" id="T2:U396"><span class="mxinfo" id="T2:U397"><span class="var type1" id="S47T69U538">YKAUG</span>(:,<span class="var type1" id="S35T3U540">k</span>)</span>-<span class="var type1" id="S50T2U541">yhat</span></span>)</span>*<span class="mxinfo" id="T18:U401">(<span class="mxinfo" id="T2:U402"><span class="mxinfo" id="T2:U403"><span class="var type1" id="S47T69U546">YKAUG</span>(:,<span class="var type1" id="S35T3U548">k</span>)</span>-<span class="var type1" id="S50T2U549">yhat</span></span>)'</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">    <span class="mxinfo" id="T70:U407"><span class="var type1" id="S52T70U552">Pxkyk</span> = <span class="mxinfo" id="T70:U409"><span class="var type1" id="S52T70U554">Pxkyk</span> + <span class="mxinfo" id="T12:U411"><span class="mxinfo" id="T2:U412"><span class="mxinfo" id="T3:U413"><span class="var type1" id="S39T68U558">wc</span>(<span class="var type1" id="S35T3U559">k</span>)</span>*(<span class="mxinfo" id="T1:U416"><span class="mxinfo" id="T1:U417"><span class="var type1" id="S36T67U563">XAUGPLUS</span>(<span class="mxinfo" id="T9:U419"><span class="mxinfo" id="T3:U420">1</span>:<span class="var type1" id="S11T3U566">n</span></span>,<span class="var type1" id="S35T3U567">k</span>)</span>-<span class="var type1" id="S42T1U568">xp</span></span>)</span>*<span class="mxinfo" id="T18:U424">(<span class="mxinfo" id="T2:U425"><span class="mxinfo" id="T2:U426"><span class="var type1" id="S47T69U573">YKAUG</span>(:,<span class="var type1" id="S35T3U575">k</span>)</span>-<span class="var type1" id="S50T2U576">yhat</span></span>)'</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">% Kalman gain</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T9:U430">any(<span class="mxinfo" id="T59:U431">any(<span class="mxinfo" id="T58:U432">isnan(<span class="var type1" id="S51T12U585">Pyk</span>)</span>)</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">    <span class="mxinfo" id="T40:U434"><span class="autoExtrinsicFcn" id="F759N4:B588">disp</span>(<span class="mxinfo" id="T84:U435"><span class="string">'Singular measurement covariance'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line">    <span class="mxinfo" id="T1:U436"><span class="var type1" id="S2T1U592">xnew</span> = <span class="mxinfo" id="T3:U438">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line">    <span class="mxinfo" id="T6:U439"><span class="var type1" id="S3T6U596">Pnew</span> = <span class="mxinfo" id="T3:U441">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line">    <span class="keyword">return</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo" id="T70:U442"><span class="var type1" id="S56T70U601">Kk</span> = <span class="mxinfo" id="T70:U444"><span class="var type1" id="S52T70U603">Pxkyk</span>*(<span class="mxinfo" id="T12:U446"><span class="var type1" id="S51T12U606">Pyk</span>\<span class="mxinfo" id="T12:U448">eye(<span class="var type1" id="S49T3U609">g</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">% handle special cases by examining the input function names</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"><span class="comment">% minimize angle difference</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="comment">%minimize diff between bearing/declination angles to agents</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"><span class="mxinfo" id="T83:U450"><span class="mxinfo" id="T83:U451"><span class="var type1" id="S50T2U613">yhat</span>(<span class="mxinfo" id="T83:U453">[<span class="mxinfo" id="T3:U454">2</span> <span class="mxinfo" id="T3:U455">3</span> <span class="mxinfo" id="T3:U456">5</span> <span class="mxinfo" id="T3:U457">6</span>]</span>)</span> = <span class="mxinfo" id="T43:U458"><span class="fcn" id="F541N9:B621">minangle</span>(<span class="mxinfo" id="T43:U459"><span class="var type1" id="S50T2U623">yhat</span>(<span class="mxinfo" id="T83:U461">[<span class="mxinfo" id="T3:U462">2</span> <span class="mxinfo" id="T3:U463">3</span> <span class="mxinfo" id="T3:U464">5</span> <span class="mxinfo" id="T3:U465">6</span>]</span>)</span>,<span class="mxinfo" id="T43:U466"><span class="var type1" id="S9T4U631">ytilde</span>(<span class="mxinfo" id="T83:U468">[<span class="mxinfo" id="T3:U469">2</span> <span class="mxinfo" id="T3:U470">3</span> <span class="mxinfo" id="T3:U471">5</span> <span class="mxinfo" id="T3:U472">6</span>]</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"><span class="comment">% normalize magnetometer</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="mxinfo" id="T50:U473"><span class="mxinfo" id="T50:U474"><span class="var type1" id="S50T2U641">yhat</span>(<span class="mxinfo" id="T50:U476"><span class="mxinfo" id="T3:U477">7</span>:<span class="mxinfo" id="T3:U478">9</span></span>)</span> = <span class="mxinfo" id="T33:U479"><span class="mxinfo" id="T33:U480"><span class="var type1" id="S50T2U647">yhat</span>(<span class="mxinfo" id="T50:U482"><span class="mxinfo" id="T3:U483">7</span>:<span class="mxinfo" id="T3:U484">9</span></span>)</span>./<span class="mxinfo" id="T3:U485">norm(<span class="mxinfo" id="T33:U486"><span class="var type1" id="S50T2U654">yhat</span>(<span class="mxinfo" id="T50:U488"><span class="mxinfo" id="T3:U489">7</span>:<span class="mxinfo" id="T3:U490">9</span></span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="comment">% minimize diff between bearing/declination to features</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo" id="T3:U491"><span class="var type1" id="S18T3U660">m1</span> = <span class="mxinfo" id="T3:U493"><span class="var type1" id="S8T4U662">uk</span>(<span class="mxinfo" id="T3:U495">10</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"><span class="mxinfo" id="T3:U496"><span class="var type1" id="S19T3U666">m2</span> = <span class="mxinfo" id="T3:U498"><span class="var type1" id="S8T4U668">uk</span>(<span class="mxinfo" id="T3:U500"><span class="mxinfo" id="T3:U501"><span class="mxinfo" id="T3:U502">10</span> + <span class="mxinfo" id="T3:U503"><span class="mxinfo" id="T3:U504">3</span>*<span class="var type1" id="S18T3U674">m1</span></span></span> + <span class="mxinfo" id="T3:U506">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo" id="T18:U507"><span class="mxinfo" id="T18:U508"><span class="var type1" id="S50T2U679">yhat</span>( <span class="mxinfo" id="T18:U510">(<span class="mxinfo" id="T18:U511">2:3:(<span class="mxinfo" id="T3:U512"><span class="mxinfo" id="T3:U513">3</span>*<span class="var type1" id="S18T3U689">m1</span></span>)</span>) + <span class="mxinfo" id="T3:U515">9</span></span>)</span> = <span class="mxinfo" id="T2:U516"><span class="fcn" id="F569N9:B692">minangle</span>(<span class="mxinfo" id="T2:U517"><span class="var type1" id="S50T2U694">yhat</span>( <span class="mxinfo" id="T18:U519">(<span class="mxinfo" id="T18:U520">2:3:(<span class="mxinfo" id="T3:U521"><span class="mxinfo" id="T3:U522">3</span>*<span class="var type1" id="S18T3U704">m1</span></span>)</span>) + <span class="mxinfo" id="T3:U524">9</span></span>)</span>,<span class="mxinfo" id="T2:U525"><span class="var type1" id="S9T4U707">ytilde</span>( <span class="mxinfo" id="T18:U527">(<span class="mxinfo" id="T18:U528">2:3:(<span class="mxinfo" id="T3:U529"><span class="mxinfo" id="T3:U530">3</span>*<span class="var type1" id="S18T3U717">m1</span></span>)</span>) + <span class="mxinfo" id="T3:U532">9</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"><span class="mxinfo" id="T18:U533"><span class="mxinfo" id="T18:U534"><span class="var type1" id="S50T2U722">yhat</span>( <span class="mxinfo" id="T18:U536">(<span class="mxinfo" id="T18:U537">3:3:(<span class="mxinfo" id="T3:U538"><span class="mxinfo" id="T3:U539">3</span>*<span class="var type1" id="S18T3U732">m1</span></span>)</span>) + <span class="mxinfo" id="T3:U541">9</span></span>)</span> = <span class="mxinfo" id="T2:U542"><span class="fcn" id="F569N9:B735">minangle</span>(<span class="mxinfo" id="T2:U543"><span class="var type1" id="S50T2U737">yhat</span>( <span class="mxinfo" id="T18:U545">(<span class="mxinfo" id="T18:U546">3:3:(<span class="mxinfo" id="T3:U547"><span class="mxinfo" id="T3:U548">3</span>*<span class="var type1" id="S18T3U747">m1</span></span>)</span>) + <span class="mxinfo" id="T3:U550">9</span></span>)</span>,<span class="mxinfo" id="T2:U551"><span class="var type1" id="S9T4U750">ytilde</span>( <span class="mxinfo" id="T18:U553">(<span class="mxinfo" id="T18:U554">3:3:(<span class="mxinfo" id="T3:U555"><span class="mxinfo" id="T3:U556">3</span>*<span class="var type1" id="S18T3U760">m1</span></span>)</span>) + <span class="mxinfo" id="T3:U558">9</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="mxinfo" id="T18:U559"><span class="mxinfo" id="T18:U560"><span class="var type1" id="S50T2U765">yhat</span>( <span class="mxinfo" id="T18:U562"><span class="mxinfo" id="T3:U563"><span class="mxinfo" id="T3:U564">9</span> + <span class="mxinfo" id="T3:U565"><span class="mxinfo" id="T3:U566">3</span>*<span class="var type1" id="S18T3U771">m1</span></span></span> + (<span class="mxinfo" id="T18:U568">2:3:<span class="mxinfo" id="T3:U569"><span class="mxinfo" id="T3:U570">3</span>*<span class="var type1" id="S19T3U779">m2</span></span></span>)</span> )</span> = <span class="mxinfo" id="T2:U572"><span class="fcn" id="F569N9:B781">minangle</span>(<span class="mxinfo" id="T2:U573"><span class="var type1" id="S50T2U783">yhat</span>( <span class="mxinfo" id="T18:U575"><span class="mxinfo" id="T3:U576"><span class="mxinfo" id="T3:U577">9</span> + <span class="mxinfo" id="T3:U578"><span class="mxinfo" id="T3:U579">3</span>*<span class="var type1" id="S18T3U789">m1</span></span></span> + (<span class="mxinfo" id="T18:U581">2:3:<span class="mxinfo" id="T3:U582"><span class="mxinfo" id="T3:U583">3</span>*<span class="var type1" id="S19T3U797">m2</span></span></span>)</span> )</span>,<span class="mxinfo" id="T2:U585"><span class="var type1" id="S9T4U799">ytilde</span>( <span class="mxinfo" id="T18:U587"><span class="mxinfo" id="T3:U588"><span class="mxinfo" id="T3:U589">9</span> + <span class="mxinfo" id="T3:U590"><span class="mxinfo" id="T3:U591">3</span>*<span class="var type1" id="S18T3U805">m1</span></span></span> + (<span class="mxinfo" id="T18:U593">2:3:<span class="mxinfo" id="T3:U594"><span class="mxinfo" id="T3:U595">3</span>*<span class="var type1" id="S19T3U813">m2</span></span></span>)</span> )</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="mxinfo" id="T18:U597"><span class="mxinfo" id="T18:U598"><span class="var type1" id="S50T2U817">yhat</span>( <span class="mxinfo" id="T18:U600"><span class="mxinfo" id="T3:U601"><span class="mxinfo" id="T3:U602">9</span> + <span class="mxinfo" id="T3:U603"><span class="mxinfo" id="T3:U604">3</span>*<span class="var type1" id="S18T3U823">m1</span></span></span> + (<span class="mxinfo" id="T18:U606">3:3:<span class="mxinfo" id="T3:U607"><span class="mxinfo" id="T3:U608">3</span>*<span class="var type1" id="S19T3U831">m2</span></span></span>)</span> )</span> = <span class="mxinfo" id="T2:U610"><span class="fcn" id="F569N9:B833">minangle</span>(<span class="mxinfo" id="T2:U611"><span class="var type1" id="S50T2U835">yhat</span>( <span class="mxinfo" id="T18:U613"><span class="mxinfo" id="T3:U614"><span class="mxinfo" id="T3:U615">9</span> + <span class="mxinfo" id="T3:U616"><span class="mxinfo" id="T3:U617">3</span>*<span class="var type1" id="S18T3U841">m1</span></span></span> + (<span class="mxinfo" id="T18:U619">3:3:<span class="mxinfo" id="T3:U620"><span class="mxinfo" id="T3:U621">3</span>*<span class="var type1" id="S19T3U849">m2</span></span></span>)</span> )</span>,<span class="mxinfo" id="T2:U623"><span class="var type1" id="S9T4U851">ytilde</span>( <span class="mxinfo" id="T18:U625"><span class="mxinfo" id="T3:U626"><span class="mxinfo" id="T3:U627">9</span> + <span class="mxinfo" id="T3:U628"><span class="mxinfo" id="T3:U629">3</span>*<span class="var type1" id="S18T3U857">m1</span></span></span> + (<span class="mxinfo" id="T18:U631">3:3:<span class="mxinfo" id="T3:U632"><span class="mxinfo" id="T3:U633">3</span>*<span class="var type1" id="S19T3U865">m2</span></span></span>)</span> )</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line"><span class="mxinfo" id="T1:U635"><span class="var type1" id="S59T1U868">xn</span> = <span class="mxinfo" id="T1:U637"><span class="var type1" id="S42T1U870">xp</span> + <span class="mxinfo" id="T1:U639"><span class="var type1" id="S56T70U872">Kk</span>*(<span class="mxinfo" id="T4:U641"><span class="var type1" id="S9T4U875">ytilde</span>-<span class="var type1" id="S50T2U876">yhat</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"><span class="comment">% renormalize quaternions as necessary</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line"><span class="mxinfo" id="T83:U644"><span class="mxinfo" id="T83:U645"><span class="var type1" id="S59T1U880">xn</span>(<span class="mxinfo" id="T83:U647"><span class="mxinfo" id="T3:U648">7</span>:<span class="mxinfo" id="T3:U649">10</span></span>)</span> = <span class="mxinfo" id="T43:U650"><span class="mxinfo" id="T43:U651"><span class="var type1" id="S59T1U886">xn</span>(<span class="mxinfo" id="T83:U653"><span class="mxinfo" id="T3:U654">7</span>:<span class="mxinfo" id="T3:U655">10</span></span>)</span>/<span class="mxinfo" id="T3:U656">norm(<span class="mxinfo" id="T43:U657"><span class="var type1" id="S59T1U893">xn</span>(<span class="mxinfo" id="T83:U659"><span class="mxinfo" id="T3:U660">7</span>:<span class="mxinfo" id="T3:U661">10</span></span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line"><span class="mxinfo" id="T83:U662"><span class="mxinfo" id="T83:U663"><span class="var type1" id="S59T1U900">xn</span>(<span class="mxinfo" id="T83:U665"><span class="mxinfo" id="T3:U666">14</span>:<span class="mxinfo" id="T3:U667">17</span></span>)</span> = <span class="mxinfo" id="T43:U668"><span class="mxinfo" id="T43:U669"><span class="var type1" id="S59T1U906">xn</span>(<span class="mxinfo" id="T83:U671"><span class="mxinfo" id="T3:U672">14</span>:<span class="mxinfo" id="T3:U673">17</span></span>)</span>/<span class="mxinfo" id="T3:U674">norm(<span class="mxinfo" id="T43:U675"><span class="var type1" id="S59T1U913">xn</span>(<span class="mxinfo" id="T83:U677"><span class="mxinfo" id="T3:U678">14</span>:<span class="mxinfo" id="T3:U679">17</span></span>)</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line"><span class="mxinfo" id="T1:U680"><span class="var type1" id="S2T1U919">xnew</span> = <span class="var type1" id="S59T1U920">xn</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line"><span class="mxinfo" id="T6:U683"><span class="var type1" id="S3T6U923">Pnew</span> = <span class="mxinfo" id="T6:U685"><span class="var type1" id="S46T6U925">Pp</span> - <span class="mxinfo" id="T70:U687"><span class="mxinfo" id="T70:U688"><span class="var type1" id="S56T70U928">Kk</span>*<span class="var type1" id="S51T12U929">Pyk</span></span>*<span class="mxinfo" id="T85:U691"><span class="var type1" id="S56T70U931">Kk</span>'</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
