<pre class="code">
<span class="srcline"><span class="lineno"><a href="123,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T69U3">yk</span> = measurement_eq_17_state(<span class="var type1" id="S3T67U6">xk</span>,<span class="var type1" id="S4T73U7">nk</span>,<span class="var type1" id="S5T4U8">uk</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="123,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="123,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% m1: # of features agent 1 sees</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% m2: # of features agent 2 sees</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="123,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%xk: 17 x 2N+1, inertial position, inertial velocity, inertial quaternion, relative position, and relative quaternion</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%nk: 12+3*m1+3*m2 x 2N+1, error on range/bearing/azimuth for agent 1, then agent 2, then magnetometer errors for agent 1 then 2, </span></span></span>
<span class="srcline"><span class="lineno"><a href="123,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%       THEN feature range/bearing/azimuth errors FOR EACH FEATURE for agent 1, then same for agent 2 </span></span></span>
<span class="srcline"><span class="lineno"><a href="123,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="123,10" id="srcline10">10</a></span><span class="line"><span class="comment">%uk[wi;ai;mag_i;# of i features;rkn;<span class="keyword">...</span><span class="comment">;# of j features;rkn;...] : 9+2+3*m x 2N+1, m being total # of features from i and j </span></span></span></span>
<span class="srcline"><span class="lineno"><a href="123,11" id="srcline11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="123,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo" id="T33:U5"><span class="var type1" id="S6T33U11">mag_i</span> = <span class="mxinfo" id="T33:U7"><span class="var type1" id="S5T4U13">uk</span>(<span class="mxinfo" id="T50:U9"><span class="mxinfo" id="T3:U10">7</span>:<span class="mxinfo" id="T3:U11">9</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="123,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo" id="T3:U12"><span class="var type1" id="S7T3U19">m1</span> = <span class="mxinfo" id="T3:U14"><span class="var type1" id="S5T4U21">uk</span>(<span class="mxinfo" id="T3:U16">10</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,15" id="srcline15">15</a></span><span class="line"><span class="mxinfo" id="T3:U17"><span class="var type1" id="S8T3U25">m2</span> = <span class="mxinfo" id="T3:U19"><span class="var type1" id="S5T4U27">uk</span>(<span class="mxinfo" id="T3:U21"><span class="mxinfo" id="T3:U22"><span class="mxinfo" id="T3:U23">10</span>+<span class="mxinfo" id="T3:U24"><span class="mxinfo" id="T3:U25">3</span>*<span class="var type1" id="S7T3U33">m1</span></span></span>+<span class="mxinfo" id="T3:U27">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo" id="T3:U28"><span class="var type1" id="S9T3U37">m</span> = <span class="mxinfo" id="T3:U30"><span class="var type1" id="S7T3U39">m1</span>+<span class="var type1" id="S8T3U40">m2</span></span></span>;<span class="comment">% total # of features</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="123,18" id="srcline18">18</a></span><span class="line"><span class="comment">% 3 x m1 array of known inertial position of features seen by agent 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,19" id="srcline19">19</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T9:U33"><span class="var type1" id="S7T3U44">m1</span> &gt; <span class="mxinfo" id="T3:U35">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="123,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo" id="T72:U36"><span class="var type1" id="S10T72U48">RKN_1</span> = <span class="mxinfo" id="T95:U38"><span class="mxinfo" id="T74:U39">reshape(<span class="mxinfo" id="T2:U40"><span class="var type1" id="S5T4U53">uk</span>(<span class="mxinfo" id="T18:U42"><span class="mxinfo" id="T3:U43">10</span>+(<span class="mxinfo" id="T18:U44">1:<span class="mxinfo" id="T3:U45"><span class="var type1" id="S7T3U60">m1</span>*<span class="mxinfo" id="T3:U47">3</span></span></span>)</span>)</span>,3,[])</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,21" id="srcline21">21</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo" id="T72:U48"><span class="var type1" id="S10T72U68">RKN_1</span> = <span class="mxinfo" id="T30:U50">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,23" id="srcline23">23</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,24" id="srcline24">24</a></span><span class="line"><span class="comment">% 3 x m2 array of known inertial position of features seen by agent 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,25" id="srcline25">25</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T9:U51"><span class="var type1" id="S8T3U74">m2</span> &gt; <span class="mxinfo" id="T3:U53">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="123,26" id="srcline26">26</a></span><span class="line">    <span class="mxinfo" id="T72:U54"><span class="var type1" id="S12T72U78">RKN_2</span> = <span class="mxinfo" id="T95:U56"><span class="mxinfo" id="T74:U57">reshape(<span class="mxinfo" id="T2:U58"><span class="var type1" id="S5T4U83">uk</span>(<span class="mxinfo" id="T18:U60"><span class="mxinfo" id="T3:U61"><span class="mxinfo" id="T3:U62">11</span>+<span class="mxinfo" id="T3:U63"><span class="mxinfo" id="T3:U64">3</span>*<span class="var type1" id="S7T3U89">m1</span></span></span>+(<span class="mxinfo" id="T18:U66">1:<span class="mxinfo" id="T3:U67"><span class="mxinfo" id="T3:U68">3</span>*<span class="var type1" id="S8T3U95">m2</span></span></span>)</span>)</span>,3,[])</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,27" id="srcline27">27</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo" id="T72:U70"><span class="var type1" id="S12T72U102">RKN_2</span> = <span class="mxinfo" id="T30:U72">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,29" id="srcline29">29</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="123,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo" id="T3:U73"><span class="var type1" id="S13T3U107">n</span> = <span class="mxinfo" id="T3:U75">size(<span class="var type1" id="S3T67U110">xk</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo" id="T3:U77"><span class="var type1" id="S15T3U114">l</span> = <span class="mxinfo" id="T3:U79">size(<span class="var type1" id="S4T73U117">nk</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="123,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo" id="T69:U81"><span class="var type1" id="S2T69U121">yk</span> = <span class="mxinfo" id="T69:U83">zeros(<span class="mxinfo" id="T3:U84"><span class="mxinfo" id="T3:U85">9</span>+<span class="mxinfo" id="T3:U86"><span class="mxinfo" id="T3:U87">3</span>*<span class="var type1" id="S9T3U128">m</span></span></span>,<span class="mxinfo" id="T3:U89">size(<span class="var type1" id="S3T67U131">xk</span>,2)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,35" id="srcline35">35</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S17T3U135">k</span> = <span class="mxinfo" id="T3:U92">1</span>:<span class="mxinfo" id="T3:U93">size(<span class="var type1" id="S3T67U140">xk</span>,2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,36" id="srcline36">36</a></span><span class="line">    <span class="comment">% i to j frame transform</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,37" id="srcline37">37</a></span><span class="line">    <span class="mxinfo" id="T43:U95"><span class="var type1" id="S18T43U144">qhat</span> = <span class="mxinfo" id="T43:U97"><span class="var type1" id="S3T67U146">xk</span>(<span class="mxinfo" id="T83:U99"><span class="mxinfo" id="T3:U100">14</span>:<span class="mxinfo" id="T3:U101">17</span></span>,<span class="var type1" id="S17T3U150">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,38" id="srcline38">38</a></span><span class="line">    <span class="comment">% est relative position in my (i) frame</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,39" id="srcline39">39</a></span><span class="line">    <span class="mxinfo" id="T33:U103"><span class="var type1" id="S19T33U153">rji_i_hat</span> = <span class="mxinfo" id="T33:U105"><span class="var type1" id="S3T67U155">xk</span>(<span class="mxinfo" id="T50:U107"><span class="mxinfo" id="T3:U108">11</span>:<span class="mxinfo" id="T3:U109">13</span></span>,<span class="var type1" id="S17T3U159">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,40" id="srcline40">40</a></span><span class="line">    <span class="comment">% estimated my inertial position</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,41" id="srcline41">41</a></span><span class="line">    <span class="mxinfo" id="T33:U111"><span class="var type1" id="S20T33U162">rin</span> = <span class="mxinfo" id="T33:U113"><span class="var type1" id="S3T67U164">xk</span>(<span class="mxinfo" id="T50:U115"><span class="mxinfo" id="T3:U116">1</span>:<span class="mxinfo" id="T3:U117">3</span></span>,<span class="var type1" id="S17T3U168">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,42" id="srcline42">42</a></span><span class="line">    <span class="comment">% my estimated inertial attitude</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,43" id="srcline43">43</a></span><span class="line">    <span class="mxinfo" id="T43:U119"><span class="var type1" id="S21T43U171">qin</span> = <span class="mxinfo" id="T43:U121"><span class="var type1" id="S3T67U173">xk</span>(<span class="mxinfo" id="T83:U123"><span class="mxinfo" id="T3:U124">7</span>:<span class="mxinfo" id="T3:U125">10</span></span>,<span class="var type1" id="S17T3U177">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,44" id="srcline44">44</a></span><span class="line">    <span class="mxinfo" id="T44:U127"><span class="var type1" id="S22T44U180">Cin</span> = <span class="mxinfo" id="T44:U129"><span class="fcn" id="F352N2:B182">attparsilentmex</span>(<span class="var type1" id="S21T43U183">qin</span>,[6 1])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,45" id="srcline45">45</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="123,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo" id="T4:U131"><span class="var type1" id="S24T4U190">nv</span> = <span class="mxinfo" id="T4:U133"><span class="var type1" id="S4T73U192">nk</span>(:,<span class="var type1" id="S17T3U194">k</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,47" id="srcline47">47</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="123,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo" id="T44:U136"><span class="var type1" id="S25T44U197">Cji</span> = <span class="mxinfo" id="T44:U138"><span class="fcn" id="F352N2:B199">attparsilentmex</span>(<span class="var type1" id="S18T43U200">qhat</span>,[6 1])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,49" id="srcline49">49</a></span><span class="line">    <span class="comment">% expected range/bearing/azimuth from agent i's measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo" id="T33:U140"><span class="mxinfo" id="T33:U141"><span class="var type1" id="S2T69U208">yk</span>(<span class="mxinfo" id="T50:U143"><span class="mxinfo" id="T3:U144">1</span>:<span class="mxinfo" id="T3:U145">3</span></span>,<span class="var type1" id="S17T3U212">k</span>)</span> = <span class="mxinfo" id="T33:U147"><span class="mxinfo" id="T33:U148">[<span class="mxinfo" id="T3:U149">sqrt(<span class="mxinfo" id="T3:U150">sum(<span class="mxinfo" id="T33:U151"><span class="var type1" id="S19T33U221">rji_i_hat</span>.^2</span>)</span>)</span>;<span class="mxinfo" id="T3:U153">atan2(<span class="mxinfo" id="T3:U154"><span class="var type1" id="S19T33U227">rji_i_hat</span>(<span class="mxinfo" id="T3:U156">2</span>)</span>,<span class="mxinfo" id="T3:U157"><span class="var type1" id="S19T33U230">rji_i_hat</span>(<span class="mxinfo" id="T3:U159">1</span>)</span>)</span>;<span class="mxinfo" id="T3:U160">atan2(<span class="mxinfo" id="T3:U161"><span class="var type1" id="S19T33U236">rji_i_hat</span>(<span class="mxinfo" id="T3:U163">3</span>)</span>,<span class="mxinfo" id="T3:U164">sqrt(<span class="mxinfo" id="T3:U165">sum(<span class="mxinfo" id="T49:U166"><span class="mxinfo" id="T49:U167"><span class="var type1" id="S19T33U244">rji_i_hat</span>(<span class="mxinfo" id="T35:U169"><span class="mxinfo" id="T3:U170">1</span>:<span class="mxinfo" id="T3:U171">2</span></span>)</span>.^2</span>)</span>)</span>)</span>]</span> + <span class="mxinfo" id="T33:U172"><span class="var type1" id="S24T4U250">nv</span>(<span class="mxinfo" id="T50:U174"><span class="mxinfo" id="T3:U175">1</span>:<span class="mxinfo" id="T3:U176">3</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,51" id="srcline51">51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="123,52" id="srcline52">52</a></span><span class="line">    <span class="comment">% expectated relative vector from agent j's measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,53" id="srcline53">53</a></span><span class="line">    <span class="mxinfo" id="T33:U177"><span class="var type1" id="S29T33U256">rij_j_hat</span> = <span class="mxinfo" id="T33:U179"><span class="mxinfo" id="T44:U180">-<span class="var type1" id="S25T44U259">Cji</span></span>*<span class="var type1" id="S19T33U260">rji_i_hat</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,54" id="srcline54">54</a></span><span class="line">    <span class="comment">% expected range/bearing/azimuth from agent j's measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,55" id="srcline55">55</a></span><span class="line">    <span class="mxinfo" id="T33:U183"><span class="mxinfo" id="T33:U184"><span class="var type1" id="S2T69U264">yk</span>(<span class="mxinfo" id="T50:U186"><span class="mxinfo" id="T3:U187">4</span>:<span class="mxinfo" id="T3:U188">6</span></span>,<span class="var type1" id="S17T3U268">k</span>)</span> = <span class="mxinfo" id="T33:U190"><span class="mxinfo" id="T33:U191">[<span class="mxinfo" id="T3:U192">sqrt(<span class="mxinfo" id="T3:U193">sum(<span class="mxinfo" id="T33:U194"><span class="var type1" id="S29T33U277">rij_j_hat</span>.^2</span>)</span>)</span>;<span class="mxinfo" id="T3:U196">atan2(<span class="mxinfo" id="T3:U197"><span class="var type1" id="S29T33U283">rij_j_hat</span>(<span class="mxinfo" id="T3:U199">2</span>)</span>,<span class="mxinfo" id="T3:U200"><span class="var type1" id="S29T33U286">rij_j_hat</span>(<span class="mxinfo" id="T3:U202">1</span>)</span>)</span>;<span class="mxinfo" id="T3:U203">atan2(<span class="mxinfo" id="T3:U204"><span class="var type1" id="S29T33U292">rij_j_hat</span>(<span class="mxinfo" id="T3:U206">3</span>)</span>,<span class="mxinfo" id="T3:U207">sqrt(<span class="mxinfo" id="T3:U208">sum(<span class="mxinfo" id="T49:U209"><span class="mxinfo" id="T49:U210"><span class="var type1" id="S29T33U300">rij_j_hat</span>(<span class="mxinfo" id="T35:U212"><span class="mxinfo" id="T3:U213">1</span>:<span class="mxinfo" id="T3:U214">2</span></span>)</span>.^2</span>)</span>)</span>)</span>]</span> + <span class="mxinfo" id="T33:U215"><span class="var type1" id="S24T4U306">nv</span>(<span class="mxinfo" id="T50:U217"><span class="mxinfo" id="T3:U218">4</span>:<span class="mxinfo" id="T3:U219">6</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,56" id="srcline56">56</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="123,57" id="srcline57">57</a></span><span class="line">    <span class="comment">% expected magnetometer measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,58" id="srcline58">58</a></span><span class="line">    <span class="mxinfo" id="T33:U220"><span class="mxinfo" id="T33:U221"><span class="var type1" id="S2T69U313">yk</span>(<span class="mxinfo" id="T50:U223"><span class="mxinfo" id="T3:U224">7</span>:<span class="mxinfo" id="T3:U225">9</span></span>,<span class="var type1" id="S17T3U317">k</span>)</span> = <span class="mxinfo" id="T33:U227"><span class="mxinfo" id="T33:U228"><span class="var type1" id="S25T44U320">Cji</span>*(<span class="mxinfo" id="T33:U230"><span class="var type1" id="S6T33U323">mag_i</span> + <span class="mxinfo" id="T33:U232"><span class="var type1" id="S24T4U325">nv</span>(<span class="mxinfo" id="T50:U234"><span class="mxinfo" id="T3:U235">7</span>:<span class="mxinfo" id="T3:U236">9</span></span>)</span></span>)</span> - <span class="mxinfo" id="T33:U237"><span class="var type1" id="S24T4U330">nv</span>(<span class="mxinfo" id="T50:U239"><span class="mxinfo" id="T3:U240">10</span>:<span class="mxinfo" id="T3:U241">12</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,59" id="srcline59">59</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="123,60" id="srcline60">60</a></span><span class="line">    <span class="comment">% feature measurements</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,61" id="srcline61">61</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S30T3U336">kk</span> = <span class="mxinfo" id="T3:U243">1</span>:<span class="var type1" id="S7T3U339">m1</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,62" id="srcline62">62</a></span><span class="line">        <span class="comment">% get the i frame vector to the feature</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,63" id="srcline63">63</a></span><span class="line">        <span class="mxinfo" id="T33:U245"><span class="var type1" id="S31T33U342">rki</span> = <span class="mxinfo" id="T33:U247"><span class="var type1" id="S22T44U344">Cin</span>*(<span class="mxinfo" id="T33:U249"><span class="mxinfo" id="T96:U250"><span class="mxinfo" id="T97:U251"><span class="var type1" id="S10T72U349">RKN_1</span>(<span class="var type1" id="S30T3U350">kk</span>,:)</span>'</span> - <span class="var type1" id="S20T33U352">rin</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,64" id="srcline64">64</a></span><span class="line">        <span class="comment">% the index for now</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,65" id="srcline65">65</a></span><span class="line">        <span class="mxinfo" id="T50:U255"><span class="var type1" id="S32T50U355">index</span> = <span class="mxinfo" id="T50:U257"><span class="mxinfo" id="T3:U258">(<span class="mxinfo" id="T3:U259"><span class="var type1" id="S30T3U360">kk</span>-<span class="mxinfo" id="T3:U261">1</span></span>)*<span class="mxinfo" id="T3:U262">3</span></span> + (<span class="mxinfo" id="T50:U263">1:3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,66" id="srcline66">66</a></span><span class="line">        <span class="comment">% compute range/bearing/declination</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,67" id="srcline67">67</a></span><span class="line">        <span class="comment">%y_kk = [sqrt(sum(rki.^2));atan2(rki(2),rki(1));atan2(rki(3),sqrt(sum(rki(1:2).^2)))] + nv(12 + index);</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,68" id="srcline68">68</a></span><span class="line">        <span class="mxinfo" id="T33:U264"><span class="var type1" id="S33T33U369">y_kk</span> = <span class="mxinfo" id="T33:U266"><span class="mxinfo" id="T33:U267"><span class="fcn" id="F509N14:B372">vector2polar</span>(<span class="var type1" id="S31T33U373">rki</span>)</span> + <span class="mxinfo" id="T33:U269"><span class="var type1" id="S24T4U375">nv</span>(<span class="mxinfo" id="T50:U271"><span class="mxinfo" id="T3:U272">12</span> + <span class="var type1" id="S32T50U378">index</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,69" id="srcline69">69</a></span><span class="line">        <span class="mxinfo" id="T33:U274"><span class="mxinfo" id="T33:U275"><span class="var type1" id="S2T69U382">yk</span>(<span class="mxinfo" id="T50:U277"><span class="mxinfo" id="T3:U278">9</span> + <span class="var type1" id="S32T50U385">index</span></span>,<span class="var type1" id="S17T3U386">k</span>)</span> = <span class="var type1" id="S33T33U387">y_kk</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,70" id="srcline70">70</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,71" id="srcline71">71</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="123,72" id="srcline72">72</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S30T3U390">kk</span> = <span class="mxinfo" id="T3:U283">1</span>:<span class="var type1" id="S8T3U393">m2</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,73" id="srcline73">73</a></span><span class="line">        <span class="comment">% get the j frame vector to the feature</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,74" id="srcline74">74</a></span><span class="line">        <span class="mxinfo" id="T33:U285"><span class="var type1" id="S35T33U396">rkj</span> = <span class="mxinfo" id="T33:U287"><span class="mxinfo" id="T44:U288"><span class="var type1" id="S25T44U399">Cji</span>*<span class="var type1" id="S22T44U400">Cin</span></span>*(<span class="mxinfo" id="T33:U291"><span class="mxinfo" id="T33:U292"><span class="mxinfo" id="T96:U293"><span class="mxinfo" id="T97:U294"><span class="var type1" id="S12T72U406">RKN_2</span>(<span class="var type1" id="S30T3U407">kk</span>,:)</span>'</span> - <span class="mxinfo" id="T33:U297"><span class="mxinfo" id="T44:U298"><span class="var type1" id="S22T44U411">Cin</span>'</span>*<span class="var type1" id="S19T33U412">rji_i_hat</span></span></span> - <span class="var type1" id="S20T33U413">rin</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,75" id="srcline75">75</a></span><span class="line">        <span class="comment">% the index for now</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,76" id="srcline76">76</a></span><span class="line">        <span class="mxinfo" id="T50:U302"><span class="var type1" id="S32T50U416">index</span> = <span class="mxinfo" id="T50:U304"><span class="mxinfo" id="T50:U305"><span class="mxinfo" id="T3:U306">(<span class="mxinfo" id="T3:U307"><span class="var type1" id="S30T3U422">kk</span>-<span class="mxinfo" id="T3:U309">1</span></span>)*<span class="mxinfo" id="T3:U310">3</span></span> + (<span class="mxinfo" id="T50:U311">1:3</span>)</span> + <span class="mxinfo" id="T3:U312"><span class="var type1" id="S7T3U430">m1</span>*<span class="mxinfo" id="T3:U314">3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,77" id="srcline77">77</a></span><span class="line">        <span class="comment">% compute range/bearing/declination</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,78" id="srcline78">78</a></span><span class="line">        <span class="comment">%y_kk = [sqrt(sum(rkj.^2));atan2(rkj(2),rkj(1));atan2(rkj(3),sqrt(sum(rkj(1:2).^2)))] + nv(12 + index);</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,79" id="srcline79">79</a></span><span class="line">        <span class="mxinfo" id="T33:U315"><span class="var type1" id="S33T33U434">y_kk</span> = <span class="mxinfo" id="T33:U317"><span class="mxinfo" id="T33:U318"><span class="fcn" id="F509N14:B437">vector2polar</span>(<span class="var type1" id="S35T33U438">rkj</span>)</span> + <span class="mxinfo" id="T33:U320"><span class="var type1" id="S24T4U440">nv</span>(<span class="mxinfo" id="T50:U322"><span class="mxinfo" id="T3:U323">12</span> + <span class="var type1" id="S32T50U443">index</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,80" id="srcline80">80</a></span><span class="line">        <span class="mxinfo" id="T33:U325"><span class="mxinfo" id="T33:U326"><span class="var type1" id="S2T69U447">yk</span>(<span class="mxinfo" id="T50:U328"><span class="mxinfo" id="T3:U329">9</span> + <span class="var type1" id="S32T50U450">index</span></span>,<span class="var type1" id="S17T3U451">k</span>)</span> = <span class="var type1" id="S33T33U452">y_kk</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,81" id="srcline81">81</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,82" id="srcline82">82</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="123,83" id="srcline83">83</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T9:U333"><span class="var type1" id="S17T3U456">k</span> &gt; <span class="mxinfo" id="T3:U335">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="123,84" id="srcline84">84</a></span><span class="line">        <span class="comment">% minimize all angle differences</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,85" id="srcline85">85</a></span><span class="line">        <span class="mxinfo" id="T43:U336"><span class="mxinfo" id="T43:U337"><span class="var type1" id="S2T69U461">yk</span>(<span class="mxinfo" id="T43:U339">[<span class="mxinfo" id="T3:U340">2</span>;<span class="mxinfo" id="T3:U341">3</span>;<span class="mxinfo" id="T3:U342">5</span>;<span class="mxinfo" id="T3:U343">6</span>]</span>,<span class="var type1" id="S17T3U471">k</span>)</span> = <span class="mxinfo" id="T43:U345"><span class="fcn" id="F541N9:B473">minangle</span>(<span class="mxinfo" id="T43:U346"><span class="var type1" id="S2T69U475">yk</span>(<span class="mxinfo" id="T43:U348">[<span class="mxinfo" id="T3:U349">2</span>;<span class="mxinfo" id="T3:U350">3</span>;<span class="mxinfo" id="T3:U351">5</span>;<span class="mxinfo" id="T3:U352">6</span>]</span>,<span class="var type1" id="S17T3U485">k</span>)</span>,<span class="mxinfo" id="T43:U354"><span class="var type1" id="S2T69U487">yk</span>(<span class="mxinfo" id="T43:U356">[<span class="mxinfo" id="T3:U357">2</span>;<span class="mxinfo" id="T3:U358">3</span>;<span class="mxinfo" id="T3:U359">5</span>;<span class="mxinfo" id="T3:U360">6</span>]</span>,<span class="mxinfo" id="T3:U361">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,86" id="srcline86">86</a></span><span class="line">        <span class="mxinfo" id="T2:U362"><span class="mxinfo" id="T2:U363"><span class="var type1" id="S2T69U501">yk</span>( <span class="mxinfo" id="T18:U365"><span class="mxinfo" id="T3:U366">9</span> + (<span class="mxinfo" id="T18:U367">2:3:<span class="mxinfo" id="T3:U368"><span class="mxinfo" id="T3:U369">3</span>*<span class="var type1" id="S7T3U511">m1</span></span></span>)</span>,<span class="var type1" id="S17T3U512">k</span> )</span> = <span class="mxinfo" id="T2:U372"><span class="fcn" id="F569N9:B514">minangle</span>(<span class="mxinfo" id="T2:U373"><span class="var type1" id="S2T69U516">yk</span>(<span class="mxinfo" id="T18:U375"><span class="mxinfo" id="T3:U376">9</span> + (<span class="mxinfo" id="T18:U377">2:3:<span class="mxinfo" id="T3:U378"><span class="mxinfo" id="T3:U379">3</span>*<span class="var type1" id="S7T3U526">m1</span></span></span>)</span>,<span class="var type1" id="S17T3U527">k</span>)</span>,<span class="mxinfo" id="T2:U382"><span class="var type1" id="S2T69U529">yk</span>(<span class="mxinfo" id="T18:U384"><span class="mxinfo" id="T3:U385">9</span> + (<span class="mxinfo" id="T18:U386">2:3:<span class="mxinfo" id="T3:U387"><span class="mxinfo" id="T3:U388">3</span>*<span class="var type1" id="S7T3U539">m1</span></span></span>)</span>,<span class="mxinfo" id="T3:U390">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,87" id="srcline87">87</a></span><span class="line">        <span class="mxinfo" id="T2:U391"><span class="mxinfo" id="T2:U392"><span class="var type1" id="S2T69U544">yk</span>( <span class="mxinfo" id="T18:U394"><span class="mxinfo" id="T3:U395">9</span> + (<span class="mxinfo" id="T18:U396">3:3:<span class="mxinfo" id="T3:U397"><span class="mxinfo" id="T3:U398">3</span>*<span class="var type1" id="S7T3U554">m1</span></span></span>)</span>,<span class="var type1" id="S17T3U555">k</span> )</span> = <span class="mxinfo" id="T2:U401"><span class="fcn" id="F569N9:B557">minangle</span>(<span class="mxinfo" id="T2:U402"><span class="var type1" id="S2T69U559">yk</span>(<span class="mxinfo" id="T18:U404"><span class="mxinfo" id="T3:U405">9</span> + (<span class="mxinfo" id="T18:U406">3:3:<span class="mxinfo" id="T3:U407"><span class="mxinfo" id="T3:U408">3</span>*<span class="var type1" id="S7T3U569">m1</span></span></span>)</span>,<span class="var type1" id="S17T3U570">k</span>)</span>,<span class="mxinfo" id="T2:U411"><span class="var type1" id="S2T69U572">yk</span>(<span class="mxinfo" id="T18:U413"><span class="mxinfo" id="T3:U414">9</span> + (<span class="mxinfo" id="T18:U415">3:3:<span class="mxinfo" id="T3:U416"><span class="mxinfo" id="T3:U417">3</span>*<span class="var type1" id="S7T3U582">m1</span></span></span>)</span>,<span class="mxinfo" id="T3:U419">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,88" id="srcline88">88</a></span><span class="line">        <span class="mxinfo" id="T2:U420"><span class="mxinfo" id="T2:U421"><span class="var type1" id="S2T69U587">yk</span>( <span class="mxinfo" id="T18:U423"><span class="mxinfo" id="T3:U424"><span class="mxinfo" id="T3:U425">9</span> + <span class="mxinfo" id="T3:U426"><span class="mxinfo" id="T3:U427">3</span>*<span class="var type1" id="S7T3U593">m1</span></span></span> + (<span class="mxinfo" id="T18:U429">2:3:<span class="mxinfo" id="T3:U430"><span class="mxinfo" id="T3:U431">3</span>*<span class="var type1" id="S8T3U601">m2</span></span></span>)</span>,<span class="var type1" id="S17T3U602">k</span> )</span> = <span class="mxinfo" id="T2:U434"><span class="fcn" id="F569N9:B604">minangle</span>( <span class="mxinfo" id="T2:U435"><span class="var type1" id="S2T69U606">yk</span>( <span class="mxinfo" id="T18:U437"><span class="mxinfo" id="T3:U438"><span class="mxinfo" id="T3:U439">9</span> + <span class="mxinfo" id="T3:U440"><span class="mxinfo" id="T3:U441">3</span>*<span class="var type1" id="S7T3U612">m1</span></span></span> + (<span class="mxinfo" id="T18:U443">2:3:<span class="mxinfo" id="T3:U444"><span class="mxinfo" id="T3:U445">3</span>*<span class="var type1" id="S8T3U620">m2</span></span></span>)</span>,<span class="var type1" id="S17T3U621">k</span> )</span>, <span class="mxinfo" id="T2:U448"><span class="var type1" id="S2T69U623">yk</span>( <span class="mxinfo" id="T18:U450"><span class="mxinfo" id="T3:U451"><span class="mxinfo" id="T3:U452">9</span> + <span class="mxinfo" id="T3:U453"><span class="mxinfo" id="T3:U454">3</span>*<span class="var type1" id="S7T3U629">m1</span></span></span> + (<span class="mxinfo" id="T18:U456">2:3:<span class="mxinfo" id="T3:U457"><span class="mxinfo" id="T3:U458">3</span>*<span class="var type1" id="S8T3U637">m2</span></span></span>)</span>,<span class="mxinfo" id="T3:U460">1</span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,89" id="srcline89">89</a></span><span class="line">        <span class="mxinfo" id="T2:U461"><span class="mxinfo" id="T2:U462"><span class="var type1" id="S2T69U642">yk</span>( <span class="mxinfo" id="T18:U464"><span class="mxinfo" id="T3:U465"><span class="mxinfo" id="T3:U466">9</span> + <span class="mxinfo" id="T3:U467"><span class="mxinfo" id="T3:U468">3</span>*<span class="var type1" id="S7T3U648">m1</span></span></span> + (<span class="mxinfo" id="T18:U470">3:3:<span class="mxinfo" id="T3:U471"><span class="mxinfo" id="T3:U472">3</span>*<span class="var type1" id="S8T3U656">m2</span></span></span>)</span>,<span class="var type1" id="S17T3U657">k</span> )</span> = <span class="mxinfo" id="T2:U475"><span class="fcn" id="F569N9:B659">minangle</span>( <span class="mxinfo" id="T2:U476"><span class="var type1" id="S2T69U661">yk</span>( <span class="mxinfo" id="T18:U478"><span class="mxinfo" id="T3:U479"><span class="mxinfo" id="T3:U480">9</span> + <span class="mxinfo" id="T3:U481"><span class="mxinfo" id="T3:U482">3</span>*<span class="var type1" id="S7T3U667">m1</span></span></span> + (<span class="mxinfo" id="T18:U484">3:3:<span class="mxinfo" id="T3:U485"><span class="mxinfo" id="T3:U486">3</span>*<span class="var type1" id="S8T3U675">m2</span></span></span>)</span>,<span class="var type1" id="S17T3U676">k</span> )</span>, <span class="mxinfo" id="T2:U489"><span class="var type1" id="S2T69U678">yk</span>( <span class="mxinfo" id="T18:U491"><span class="mxinfo" id="T3:U492"><span class="mxinfo" id="T3:U493">9</span> + <span class="mxinfo" id="T3:U494"><span class="mxinfo" id="T3:U495">3</span>*<span class="var type1" id="S7T3U684">m1</span></span></span> + (<span class="mxinfo" id="T18:U497">3:3:<span class="mxinfo" id="T3:U498"><span class="mxinfo" id="T3:U499">3</span>*<span class="var type1" id="S8T3U692">m2</span></span></span>)</span>,<span class="mxinfo" id="T3:U501">1</span> )</span> )</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="123,90" id="srcline90">90</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,91" id="srcline91">91</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="123,92" id="srcline92">92</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="123,93" id="srcline93">93</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
